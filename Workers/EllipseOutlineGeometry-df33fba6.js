define(["exports","./GeometryOffsetAttribute-03006e80","./Transforms-1142ce48","./Cartesian2-08065eec","./ComponentDatatype-a867ddaa","./when-ad3237a0","./Check-be2d5acb","./EllipseGeometryLibrary-002b2f96","./GeometryAttribute-da891979","./GeometryAttributes-27dc652d","./IndexDatatype-9504f550","./Math-5ca9b250"],(function(e,t,i,r,a,n,o,s,u,l,d,p){"use strict";var c=new r.Cartesian3,f=new r.Cartesian3,m=new i.BoundingSphere,h=new i.BoundingSphere;function y(e){var t=(e=n.defaultValue(e,n.defaultValue.EMPTY_OBJECT)).center,i=n.defaultValue(e.ellipsoid,r.Ellipsoid.WGS84),a=e.semiMajorAxis,o=e.semiMinorAxis,s=n.defaultValue(e.granularity,p.CesiumMath.RADIANS_PER_DEGREE),u=n.defaultValue(e.height,0),l=n.defaultValue(e.extrudedHeight,u);this._center=r.Cartesian3.clone(t),this._semiMajorAxis=a,this._semiMinorAxis=o,this._ellipsoid=r.Ellipsoid.clone(i),this._rotation=n.defaultValue(e.rotation,0),this._height=Math.max(l,u),this._granularity=s,this._extrudedHeight=Math.min(l,u),this._numberOfVerticalLines=Math.max(n.defaultValue(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}y.packedLength=r.Cartesian3.packedLength+r.Ellipsoid.packedLength+8,y.pack=function(e,t,i){return i=n.defaultValue(i,0),r.Cartesian3.pack(e._center,t,i),i+=r.Cartesian3.packedLength,r.Ellipsoid.pack(e._ellipsoid,t,i),i+=r.Ellipsoid.packedLength,t[i++]=e._semiMajorAxis,t[i++]=e._semiMinorAxis,t[i++]=e._rotation,t[i++]=e._height,t[i++]=e._granularity,t[i++]=e._extrudedHeight,t[i++]=e._numberOfVerticalLines,t[i]=n.defaultValue(e._offsetAttribute,-1),t};var b=new r.Cartesian3,A=new r.Ellipsoid,_={center:b,ellipsoid:A,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};y.unpack=function(e,t,i){t=n.defaultValue(t,0);var a=r.Cartesian3.unpack(e,t,b);t+=r.Cartesian3.packedLength;var o=r.Ellipsoid.unpack(e,t,A);t+=r.Ellipsoid.packedLength;var s=e[t++],u=e[t++],l=e[t++],d=e[t++],p=e[t++],c=e[t++],f=e[t++];return t=e[t],n.defined(i)?(i._center=r.Cartesian3.clone(a,i._center),i._ellipsoid=r.Ellipsoid.clone(o,i._ellipsoid),i._semiMajorAxis=s,i._semiMinorAxis=u,i._rotation=l,i._height=d,i._granularity=p,i._extrudedHeight=c,i._numberOfVerticalLines=f,i._offsetAttribute=-1===t?void 0:t,i):(_.height=d,_.extrudedHeight=c,_.granularity=p,_.rotation=l,_.semiMajorAxis=s,_.semiMinorAxis=u,_.numberOfVerticalLines=f,_.offsetAttribute=-1===t?void 0:t,new y(_))},y.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var o,y=e._height,b=e._extrudedHeight,A=!p.CesiumMath.equalsEpsilon(y,b,0,p.CesiumMath.EPSILON2);return e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center),y={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:y,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines},A?(y.extrudedHeight=b,y.offsetAttribute=e._offsetAttribute,o=function(e){var o=e.center,f=e.ellipsoid,y=e.semiMajorAxis,b=r.Cartesian3.multiplyByScalar(f.geodeticSurfaceNormal(o,c),e.height,c);m.center=r.Cartesian3.add(o,b,m.center),m.radius=y,b=r.Cartesian3.multiplyByScalar(f.geodeticSurfaceNormal(o,b),e.extrudedHeight,b),h.center=r.Cartesian3.add(o,b,h.center),h.radius=y,o=s.EllipseGeometryLibrary.computeEllipsePositions(e,!1,!0).outerPositions,o=(b=new l.GeometryAttributes({position:new u.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s.EllipseGeometryLibrary.raisePositionsToHeight(o,e,!0)})})).position.values,y=i.BoundingSphere.union(m,h);var A=o.length/3;n.defined(e.offsetAttribute)&&(_=new Uint8Array(A),_=e.offsetAttribute===t.GeometryOffsetAttribute.TOP?t.arrayFill(_,1,0,A/2):(o=e.offsetAttribute===t.GeometryOffsetAttribute.NONE?0:1,t.arrayFill(_,o)),b.applyOffset=new u.GeometryAttribute({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:_}));var _=n.defaultValue(e.numberOfVerticalLines,16),g=(_=p.CesiumMath.clamp(_,0,A/2),d.IndexDatatype.createTypedArray(A,2*A+2*_));A/=2;var x=0;for(M=0;M<A;++M)g[x++]=M,g[x++]=(M+1)%A,g[x++]=M+A,g[x++]=(M+1)%A+A;if(0<_){e=Math.min(_,A);for(var E=Math.round(A/e),v=Math.min(E*_,A),M=0;M<v;M+=E)g[x++]=M,g[x++]=M+A}return{boundingSphere:y,attributes:b,indices:g}}(y)):(o=function(e){var t=e.center;f=r.Cartesian3.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,f),e.height,f),f=r.Cartesian3.add(t,f,f);for(var n=new i.BoundingSphere(f,e.semiMajorAxis),o=(t=s.EllipseGeometryLibrary.computeEllipsePositions(e,!1,!0).outerPositions,e=new l.GeometryAttributes({position:new u.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s.EllipseGeometryLibrary.raisePositionsToHeight(t,e,!1)})}),t.length/3),p=d.IndexDatatype.createTypedArray(o,2*o),c=0,m=0;m<o;++m)p[c++]=m,p[c++]=(m+1)%o;return{boundingSphere:n,attributes:e,indices:p}}(y),n.defined(e._offsetAttribute)&&(b=o.attributes.position.values.length,y=new Uint8Array(b/3),b=e._offsetAttribute===t.GeometryOffsetAttribute.NONE?0:1,t.arrayFill(y,b),o.attributes.applyOffset=new u.GeometryAttribute({componentDatatype:a.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:y}))),new u.Geometry({attributes:o.attributes,indices:o.indices,primitiveType:u.PrimitiveType.LINES,boundingSphere:o.boundingSphere,offsetAttribute:e._offsetAttribute})}},e.EllipseOutlineGeometry=y}));