define(["./AttributeCompression-9fbb8447","./Cartesian2-08065eec","./combine-1510933d","./IndexDatatype-9504f550","./Math-5ca9b250","./createTaskProcessorWorker","./Check-be2d5acb","./when-ad3237a0","./WebGLConstants-1c8239cc"],(function(a,e,t,r,s,n,i,o,d){"use strict";var c=32767,f=Math.cos(s.CesiumMath.toRadians(150)),l=new e.Cartographic,h=new e.Cartesian3,u=new e.Cartographic,C=new e.Cartographic;function p(a){var e=8*a,t=3*e,s=4*e;this.startEllipsoidNormals=new Float32Array(t),this.endEllipsoidNormals=new Float32Array(t),this.startPositionAndHeights=new Float32Array(s),this.startFaceNormalAndVertexCornerIds=new Float32Array(s),this.endPositionAndHeights=new Float32Array(s),this.endFaceNormalAndHalfWidths=new Float32Array(s),this.vertexBatchIds=new Uint16Array(e),this.indices=r.IndexDatatype.createTypedArray(e,36*a),this.vec3Offset=0,this.vec4Offset=0,this.batchIdOffset=0,this.indexOffset=0,this.volumeStartIndex=0}var b=new e.Cartesian3,m=new e.Cartesian3;function A(a,t,r,s,n){var i=e.Cartesian3.subtract(r,t,m);return r=e.Cartesian3.subtract(t,a,b),e.Cartesian3.normalize(i,i),e.Cartesian3.normalize(r,r),e.Cartesian3.dot(i,r)<f&&(r=e.Cartesian3.multiplyByScalar(r,-1,b)),e.Cartesian3.add(i,r,n),e.Cartesian3.equals(n,e.Cartesian3.ZERO)&&(n=e.Cartesian3.subtract(a,t)),e.Cartesian3.cross(n,s,n),e.Cartesian3.cross(s,n,n),e.Cartesian3.normalize(n,n),n}var w=[0,2,6,0,6,4,0,1,3,0,3,2,0,4,5,0,5,1,5,3,1,5,7,3,7,5,4,7,4,6,7,6,2,7,2,3],v=w.length,g=new e.Cartesian3,y=new e.Cartesian3,N=new e.Cartesian3,k=new e.Cartesian3,I=new e.Cartesian3;p.prototype.addVolume=function(a,t,r,s,n,i,o,d,c,f){for(var l=e.Cartesian3.add(t,c,g),h=f.geodeticSurfaceNormal(l,y),u=(l=e.Cartesian3.add(r,c,g),f.geodeticSurfaceNormal(l,k)),C=A(a,t,r,h,N),p=A(s,r,t,u,I),b=this.startEllipsoidNormals,m=this.endEllipsoidNormals,x=this.startPositionAndHeights,E=this.startFaceNormalAndVertexCornerIds,F=this.endPositionAndHeights,H=this.endFaceNormalAndHalfWidths,O=this.vertexBatchIds,P=this.batchIdOffset,D=this.vec3Offset,S=this.vec4Offset,M=0;M<8;M++)e.Cartesian3.pack(h,b,D),e.Cartesian3.pack(u,m,D),e.Cartesian3.pack(t,x,S),x[S+3]=n,e.Cartesian3.pack(r,F,S),F[S+3]=i,e.Cartesian3.pack(C,E,S),E[S+3]=M,e.Cartesian3.pack(p,H,S),H[S+3]=o,O[P++]=d,D+=3,S+=4;this.batchIdOffset=P,this.vec3Offset=D,this.vec4Offset=S;var U=this.indices,B=this.volumeStartIndex,R=this.indexOffset;for(M=0;M<v;M++)U[R+M]=w[M]+B;this.volumeStartIndex+=8,this.indexOffset+=v};var x=new e.Rectangle,E=new e.Ellipsoid,F=new e.Cartesian3,H=new e.Cartesian3,O=new e.Cartesian3,P=new e.Cartesian3,D=new e.Cartesian3;return n((function(n,i){var o=new Uint16Array(n.positions),d=new Uint16Array(n.widths),f=new Uint32Array(n.counts),b=new Uint16Array(n.batchIds),m=x,A=E,w=F,v=0,g=(k=new Float64Array(n.packedBuffer))[v++],y=k[v++];e.Rectangle.unpack(k,2,m),v+=e.Rectangle.packedLength,e.Ellipsoid.unpack(k,v,A),v+=e.Ellipsoid.packedLength,e.Cartesian3.unpack(k,v,w);var N=o.length/3,k=o.subarray(0,N),I=(v=o.subarray(N,2*N),o.subarray(2*N,3*N));a.AttributeCompression.zigZagDeltaDecode(k,v,I),function(a,t,r,s){for(var n=s.length,i=a.length,o=new Uint8Array(i),d=u,c=C,f=0,l=0;l<n;l++){for(var h=s[l],p=h,b=1;b<h;b++){var m=f+b,A=m-1;c.longitude=a[m],c.latitude=t[m],d.longitude=a[A],d.latitude=t[A],e.Cartographic.equals(c,d)&&(p--,o[A]=1)}s[l]=p,f+=h}for(var w=0,v=0;v<i;v++)1!==o[v]&&(a[w]=a[v],t[w]=t[v],r[w]=r[v],w++)}(k,v,I,f);for(var S=f.length,M=0,U=0;U<S;U++)M+=f[U]-1;var B=new p(M),R=function(a,t,r,n,i,o,d){for(var f=a.length,u=new Float64Array(3*f),C=0;C<f;++C){var p=a[C],b=t[C],m=r[C];p=s.CesiumMath.lerp(n.west,n.east,p/c),b=s.CesiumMath.lerp(n.south,n.north,b/c),m=s.CesiumMath.lerp(i,o,m/c),m=e.Cartographic.fromRadians(p,b,m,l),m=d.cartographicToCartesian(m,h),e.Cartesian3.pack(m,u,3*C)}return u}(k,v,I,m,g,y,A),T=(N=k.length,new Float32Array(3*N));for(U=0;U<N;++U)T[3*U]=R[3*U]-w.x,T[3*U+1]=R[3*U+1]-w.y,T[3*U+2]=R[3*U+2]-w.z;var V=0,W=0;for(U=0;U<S;U++){for(var z=f[U]-1,q=.5*d[U],L=b[U],_=V,G=0;G<z;G++){var Z=e.Cartesian3.unpack(T,V,O),Y=e.Cartesian3.unpack(T,V+3,P),j=I[W],J=I[W+1];j=s.CesiumMath.lerp(g,y,j/c),J=s.CesiumMath.lerp(g,y,J/c),W++;var K,Q,X,$=H,aa=D;0===G?(Q=e.Cartesian3.unpack(T,K=_+3*z,H),e.Cartesian3.equals(Q,Z)?e.Cartesian3.unpack(T,K-3,$):(X=e.Cartesian3.subtract(Z,Y,H),$=e.Cartesian3.add(X,Z,H))):e.Cartesian3.unpack(T,V-3,$),G===z-1?(X=e.Cartesian3.unpack(T,_,D),e.Cartesian3.equals(X,Y)?e.Cartesian3.unpack(T,_+3,aa):(X=e.Cartesian3.subtract(Y,Z,D),aa=e.Cartesian3.add(X,Y,D))):e.Cartesian3.unpack(T,V+6,aa),B.addVolume($,Z,Y,aa,j,J,q,L,w,A),V+=3}V+=3,W++}return k=B.indices,i.push(B.startEllipsoidNormals.buffer),i.push(B.endEllipsoidNormals.buffer),i.push(B.startPositionAndHeights.buffer),i.push(B.startFaceNormalAndVertexCornerIds.buffer),i.push(B.endPositionAndHeights.buffer),i.push(B.endFaceNormalAndHalfWidths.buffer),i.push(B.vertexBatchIds.buffer),i.push(k.buffer),k={indexDatatype:2===k.BYTES_PER_ELEMENT?r.IndexDatatype.UNSIGNED_SHORT:r.IndexDatatype.UNSIGNED_INT,startEllipsoidNormals:B.startEllipsoidNormals.buffer,endEllipsoidNormals:B.endEllipsoidNormals.buffer,startPositionAndHeights:B.startPositionAndHeights.buffer,startFaceNormalAndVertexCornerIds:B.startFaceNormalAndVertexCornerIds.buffer,endPositionAndHeights:B.endPositionAndHeights.buffer,endFaceNormalAndHalfWidths:B.endFaceNormalAndHalfWidths.buffer,vertexBatchIds:B.vertexBatchIds.buffer,indices:k.buffer},n.keepDecodedPositions&&(n=function(a){for(var e=a.length,t=new Uint32Array(e+1),r=0,s=0;s<e;++s)t[s]=r,r+=a[s];return t[e]=r,t}(f),i.push(R.buffer,n.buffer),k=t.combine(k,{decodedPositions:R.buffer,decodedPositionOffsets:n.buffer})),k}))}));