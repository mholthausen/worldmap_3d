define(["./AxisAlignedBoundingBox-718a9087","./Cartesian2-08065eec","./when-ad3237a0","./TerrainEncoding-cd3482b3","./IndexDatatype-9504f550","./Math-5ca9b250","./Transforms-1142ce48","./Check-be2d5acb","./WebMercatorProjection-2bca7e98","./createTaskProcessorWorker","./AttributeCompression-9fbb8447","./ComponentDatatype-a867ddaa","./WebGLConstants-1c8239cc","./combine-1510933d","./RuntimeError-767bd866"],(function(e,t,r,n,i,o,a,s,d,c,h,u,I,l,g){"use strict";function m(){s.DeveloperError.throwInstantiationError()}Object.defineProperties(m.prototype,{errorEvent:{get:s.DeveloperError.throwInstantiationError},credit:{get:s.DeveloperError.throwInstantiationError},tilingScheme:{get:s.DeveloperError.throwInstantiationError},ready:{get:s.DeveloperError.throwInstantiationError},readyPromise:{get:s.DeveloperError.throwInstantiationError},hasWaterMask:{get:s.DeveloperError.throwInstantiationError},hasVertexNormals:{get:s.DeveloperError.throwInstantiationError},availability:{get:s.DeveloperError.throwInstantiationError}});var T=[];m.getRegularGridIndices=function(e,t){var n=T[e];r.defined(n)||(T[e]=n=[]);var i=n[t];return r.defined(i)||y(e,t,i=e*t<o.CesiumMath.SIXTY_FOUR_KILOBYTES?n[t]=new Uint16Array((e-1)*(t-1)*6):n[t]=new Uint32Array((e-1)*(t-1)*6),0),i};var E=[];m.getRegularGridIndicesAndEdgeIndices=function(e,t){var n=E[e];r.defined(n)||(E[e]=n=[]);var i,o,a,s,d=n[t];return r.defined(d)||(i=m.getRegularGridIndices(e,t),o=(s=f(e,t)).westIndicesSouthToNorth,a=s.southIndicesEastToWest,e=s.eastIndicesNorthToSouth,s=s.northIndicesWestToEast,d=n[t]={indices:i,westIndicesSouthToNorth:o,southIndicesEastToWest:a,eastIndicesNorthToSouth:e,northIndicesWestToEast:s}),d};var p=[];function f(e,t){for(var r=new Array(t),n=new Array(e),i=new Array(t),o=new Array(e),a=0;a<e;++a)n[o[a]=a]=e*t-1-a;for(a=0;a<t;++a)i[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:i,northIndicesWestToEast:o}}function y(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,d=s+e,c=d+1,h=s+1;r[n++]=s,r[n++]=d,r[n++]=h,r[n++]=h,r[n++]=d,r[n++]=c,++i}++i}}function v(e,t,r,n){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[n++]=i,r[n++]=s,r[n++]=t,r[n++]=t,r[n++]=s,r[n++]=t+1,i=s,++t}return n}m.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var n=p[e];r.defined(n)||(p[e]=n=[]);var o,a,s,d,c,h,u,I,l=n[t];return r.defined(l)||(s=(o=e*t)+(h=2*e+2*t),I=(a=(e-1)*(t-1)*6)+6*Math.max(0,h-4),d=(u=f(e,t)).westIndicesSouthToNorth,c=u.southIndicesEastToWest,h=u.eastIndicesNorthToSouth,u=u.northIndicesWestToEast,y(e,t,I=i.IndexDatatype.createTypedArray(s,I),0),m.addSkirtIndices(d,c,h,u,o,I,a),l=n[t]={indices:I,westIndicesSouthToNorth:d,southIndicesEastToWest:c,eastIndicesNorthToSouth:h,northIndicesWestToEast:u,indexCountWithoutSkirts:a}),l},m.addSkirtIndices=function(e,t,r,n,i,o,a){a=v(e,i,o,a),a=v(t,i+=e.length,o,a),a=v(r,i+=t.length,o,a),v(n,i+=r.length,o,a)},m.heightmapTerrainQuality=.25,m.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*m.heightmapTerrainQuality/(t*r)},m.prototype.requestTileGeometry=s.DeveloperError.throwInstantiationError,m.prototype.getLevelMaximumGeometricError=s.DeveloperError.throwInstantiationError,m.prototype.getTileDataAvailable=s.DeveloperError.throwInstantiationError,m.prototype.loadTileDataAvailability=s.DeveloperError.throwInstantiationError;var N=32767,w=new t.Cartesian3,b=new t.Cartesian3,S=new t.Cartesian3,M=new t.Cartographic,x=new t.Cartesian2;function C(e,r,n,i,s,d,c,h,u){var I=Number.POSITIVE_INFINITY,l=s.north,g=s.south,m=s.east,T=s.west;m<T&&(m+=o.CesiumMath.TWO_PI);for(var E=e.length,p=0;p<E;++p){var f=n[y=e[p]],y=i[y];M.longitude=o.CesiumMath.lerp(T,m,y.x),M.latitude=o.CesiumMath.lerp(g,l,y.y),M.height=f-r,f=d.cartographicToCartesian(M,w),a.Matrix4.multiplyByPoint(c,f,f),t.Cartesian3.minimumByComponent(f,h,h),t.Cartesian3.maximumByComponent(f,u,u),I=Math.min(I,M.height)}return I}function A(e,t,n,i,a,s,c,h,u,I,l,g,m,T){var E=r.defined(c),p=u.north,f=u.south,y=u.east,v=u.west;y<v&&(y+=o.CesiumMath.TWO_PI);for(var N=n.length,b=0;b<N;++b){var S,C,A=n[b],W=a[A],P=s[A];M.longitude=o.CesiumMath.lerp(v,y,P.x)+m,M.latitude=o.CesiumMath.lerp(f,p,P.y)+T,M.height=W-I,W=h.cartographicToCartesian(M,w),E&&(x.x=c[A*=2],x.y=c[1+A]),i.hasWebMercatorT&&(S=(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(M.latitude)-l)*g),i.hasGeodeticSurfaceNormals&&(C=h.geodeticSurfaceNormal(W)),t=i.encode(e,t,W,P,M.height,x,S,C)}}function W(e,t){var n;return"function"==typeof e.slice&&"function"!=typeof(n=e.slice()).sort&&(n=void 0),(n=r.defined(n)?n:Array.prototype.slice.call(e)).sort(t),n}return c((function(s,c){var h,u,I=(me=s.quantizedVertices).length/3,l=s.octEncodedNormals,g=s.westIndices.length+s.eastIndices.length+s.southIndices.length+s.northIndices.length,T=s.includeWebMercatorT,E=s.exaggeration,p=s.exaggerationRelativeHeight,f=1!==E,y=t.Rectangle.clone(s.rectangle),v=y.west,P=y.south,D=y.east,k=y.north,F=t.Ellipsoid.clone(s.ellipsoid),H=s.minimumHeight,_=s.maximumHeight,G=s.relativeToCenter,V=a.Transforms.eastNorthUpToFixedFrame(G,F),Y=a.Matrix4.inverseTransformation(V,new a.Matrix4);T&&(h=d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(P),u=1/(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(k)-h));var O=me.subarray(0,I),B=me.subarray(I,2*I),R=me.subarray(2*I,3*I),L=r.defined(l),j=new Array(I),U=new Array(I),z=new Array(I),q=T?new Array(I):[],Q=f?new Array(I):[],K=b;K.x=Number.POSITIVE_INFINITY,K.y=Number.POSITIVE_INFINITY,K.z=Number.POSITIVE_INFINITY;var X=S;X.x=Number.NEGATIVE_INFINITY,X.y=Number.NEGATIVE_INFINITY,X.z=Number.NEGATIVE_INFINITY;for(var Z=Number.POSITIVE_INFINITY,J=Number.NEGATIVE_INFINITY,$=Number.POSITIVE_INFINITY,ee=Number.NEGATIVE_INFINITY,te=0;te<I;++te){var re=O[te],ne=B[te],ie=re/N,oe=ne/N;re=o.CesiumMath.lerp(H,_,R[te]/N),M.longitude=o.CesiumMath.lerp(v,D,ie),M.latitude=o.CesiumMath.lerp(P,k,oe),M.height=re,Z=Math.min(M.longitude,Z),J=Math.max(M.longitude,J),$=Math.min(M.latitude,$),ee=Math.max(M.latitude,ee),ne=F.cartographicToCartesian(M),j[te]=new t.Cartesian2(ie,oe),U[te]=re,z[te]=ne,T&&(q[te]=(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(M.latitude)-h)*u),f&&(Q[te]=F.geodeticSurfaceNormal(ne)),a.Matrix4.multiplyByPoint(Y,ne,w),t.Cartesian3.minimumByComponent(w,K,K),t.Cartesian3.maximumByComponent(w,X,X)}var ae,se=W(s.westIndices,(function(e,t){return j[e].y-j[t].y})),de=W(s.eastIndices,(function(e,t){return j[t].y-j[e].y})),ce=W(s.southIndices,(function(e,t){return j[t].x-j[e].x})),he=W(s.northIndices,(function(e,t){return j[e].x-j[t].x}));H<0&&(ae=new n.EllipsoidalOccluder(F).computeHorizonCullingPointPossiblyUnderEllipsoid(G,z,H));var ue=Math.min(H,C(s.westIndices,s.westSkirtHeight,U,j,y,F,Y,K,X));ue=Math.min(ue,C(s.southIndices,s.southSkirtHeight,U,j,y,F,Y,K,X)),ue=Math.min(ue,C(s.eastIndices,s.eastSkirtHeight,U,j,y,F,Y,K,X)),ue=Math.min(ue,C(s.northIndices,s.northSkirtHeight,U,j,y,F,Y,K,X));for(var Ie,le=new e.AxisAlignedBoundingBox(K,X,G),ge=new n.TerrainEncoding(G,le,ue,_,V,L,T,f,E,p),me=ge.stride,Te=new Float32Array(I*me+g*me),Ee=0,pe=0;pe<I;++pe)L&&(x.x=l[Ie=2*pe],x.y=l[1+Ie]),Ee=ge.encode(Te,Ee,z[pe],j[pe],U[pe],x,q[pe],Q[pe]);return le=Math.max(0,2*(g-4)),ue=s.indices.length+3*le,(V=i.IndexDatatype.createTypedArray(I+g,ue)).set(s.indices,0),le=E=1e-4*(J-Z),ue=-(g=p=1e-4*(ee-$)),A(Te,p=I*me,se,ge,U,j,l,F,y,s.westSkirtHeight,h,u,-E,0),A(Te,p+=s.westIndices.length*me,ce,ge,U,j,l,F,y,s.southSkirtHeight,h,u,0,ue),A(Te,p+=s.southIndices.length*me,de,ge,U,j,l,F,y,s.eastSkirtHeight,h,u,le,0),A(Te,p+=s.eastIndices.length*me,he,ge,U,j,l,F,y,s.northSkirtHeight,h,u,0,g),m.addSkirtIndices(se,ce,de,he,I,V,s.indices.length),c.push(Te.buffer,V.buffer),{vertices:Te.buffer,indices:V.buffer,westIndicesSouthToNorth:se,southIndicesEastToWest:ce,eastIndicesNorthToSouth:de,northIndicesWestToEast:he,vertexStride:me,center:G,minimumHeight:H,maximumHeight:_,occludeePointInScaledSpace:ae,encoding:ge,indexCountWithoutSkirts:s.indices.length}}))}));