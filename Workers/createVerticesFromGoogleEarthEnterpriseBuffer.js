/*! For license information please see createVerticesFromGoogleEarthEnterpriseBuffer.js.LICENSE.txt */
import{a as Dt,b as Gt}from"./chunk-XRIISOYZ.js";import{a as Lt}from"./chunk-65CN64EP.js";import{a as lt}from"./chunk-3BNGKZ2F.js";import{a as qt}from"./chunk-UQ3ABODK.js";import"./chunk-NYNUONZK.js";import"./chunk-C7EXJG2O.js";import{a as kt}from"./chunk-LM5DN6BS.js";import"./chunk-S3NLG5WM.js";import"./chunk-AAOMPF7M.js";import{d as zt}from"./chunk-KYREMICR.js";import{b as $,g as Ot,h as Vt}from"./chunk-VBRVI5XI.js";import"./chunk-5ZFOKSDK.js";import{a as P,b as N,c as wt,d as Ut}from"./chunk-7L2LUDC3.js";import{a as r}from"./chunk-77KFIUJG.js";import"./chunk-7W3OTLHS.js";import{a as Ht}from"./chunk-X52A3GF7.js";import"./chunk-PX3QTMVS.js";import{e as ht}from"./chunk-FE4HG5RY.js";var $t=Uint16Array.BYTES_PER_ELEMENT,mt=Int32Array.BYTES_PER_ELEMENT,Pt=Uint32Array.BYTES_PER_ELEMENT,te=Float32Array.BYTES_PER_ELEMENT,H=Float64Array.BYTES_PER_ELEMENT;function tt(t,e,n){n=n??r;let i=t.length;for(let o=0;o<i;++o)if(n.equalsEpsilon(t[o],e,r.EPSILON12))return o;return-1}function ee(t,e){t.ellipsoid=Ut.clone(t.ellipsoid),t.rectangle=Vt.clone(t.rectangle);let n=re(t.buffer,t.relativeToCenter,t.ellipsoid,t.rectangle,t.nativeRectangle,t.exaggeration,t.exaggerationRelativeHeight,t.skirtHeight,t.includeWebMercatorT,t.negativeAltitudeExponentBias,t.negativeElevationThreshold),i=n.vertices;e.push(i.buffer);let r=n.indices;return e.push(r.buffer),{vertices:i.buffer,indices:r.buffer,numberOfAttributes:n.encoding.stride,minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight,boundingSphere3D:n.boundingSphere3D,orientedBoundingBox:n.orientedBoundingBox,occludeePointInScaledSpace:n.occludeePointInScaledSpace,encoding:n.encoding,vertexCountWithoutSkirts:n.vertexCountWithoutSkirts,indexCountWithoutSkirts:n.indexCountWithoutSkirts,westIndicesSouthToNorth:n.westIndicesSouthToNorth,southIndicesEastToWest:n.southIndicesEastToWest,eastIndicesNorthToSouth:n.eastIndicesNorthToSouth,northIndicesWestToEast:n.northIndicesWestToEast}}var u=new N,G=new P,oe=new P,ne=new P,ie=new $;function re(t,e,n,i,o,a,s,l,h,c,d){let m,g,p,I,f,E;ht(i)?(m=i.west,g=i.south,p=i.east,I=i.north,f=i.width,E=i.height):(m=r.toRadians(o.west),g=r.toRadians(o.south),p=r.toRadians(o.east),I=r.toRadians(o.north),f=r.toRadians(i.width),E=r.toRadians(i.height));let T,S,x=[g,I],w=[m,p],k=Ot.eastNorthUpToFixedFrame(e,n),R=$.inverseTransformation(k,ie);h&&(T=lt.geodeticLatitudeToMercatorAngle(g),S=1/(lt.geodeticLatitudeToMercatorAngle(I)-T));let b=1!==a,A=new DataView(t),M=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,y=oe;y.x=Number.POSITIVE_INFINITY,y.y=Number.POSITIVE_INFINITY,y.z=Number.POSITIVE_INFINITY;let B=ne;B.x=Number.NEGATIVE_INFINITY,B.y=Number.NEGATIVE_INFINITY,B.z=Number.NEGATIVE_INFINITY;let v,_,O=0,j=0,C=0;for(_=0;_<4;++_){let t=O;v=A.getUint32(t,!0),t+=Pt;let e=r.toRadians(180*A.getFloat64(t,!0));t+=H,-1===tt(w,e)&&w.push(e);let n=r.toRadians(180*A.getFloat64(t,!0));t+=H,-1===tt(x,n)&&x.push(n),t+=2*H;let i=A.getInt32(t,!0);t+=mt,j+=i,i=A.getInt32(t,!0),C+=3*i,O+=v+Pt}let U=[],W=[],Y=new Array(j),L=new Array(j),V=new Array(j),D=h?new Array(j):[],K=b?new Array(j):[],z=new Array(C),X=[],Z=[],q=[],J=[],Q=0,et=0;for(O=0,_=0;_<4;++_){v=A.getUint32(O,!0),O+=Pt;let t=O,e=r.toRadians(180*A.getFloat64(O,!0));O+=H;let i=r.toRadians(180*A.getFloat64(O,!0));O+=H;let o=r.toRadians(180*A.getFloat64(O,!0)),a=.5*o;O+=H;let s=r.toRadians(180*A.getFloat64(O,!0)),l=.5*s;O+=H;let f=A.getInt32(O,!0);O+=mt;let E=A.getInt32(O,!0);O+=mt,O+=mt;let k=new Array(f);for(let t=0;t<f;++t){let f=e+A.getUint8(O++)*o;u.longitude=f;let E=i+A.getUint8(O++)*s;u.latitude=E;let v=A.getFloat32(O,!0);if(O+=te,0!==v&&v<d&&(v*=-Math.pow(2,c)),v*=6371010,u.height=v,-1!==tt(w,f)||-1!==tt(x,E)){let e=tt(U,u,N);if(-1!==e){k[t]=W[e];continue}U.push(N.clone(u)),W.push(Q)}k[t]=Q,Math.abs(f-m)<a?X.push({index:Q,cartographic:N.clone(u)}):Math.abs(f-p)<a?q.push({index:Q,cartographic:N.clone(u)}):Math.abs(E-g)<l?Z.push({index:Q,cartographic:N.clone(u)}):Math.abs(E-I)<l&&J.push({index:Q,cartographic:N.clone(u)}),M=Math.min(v,M),F=Math.max(v,F),V[Q]=v;let H=n.cartographicToCartesian(u);if(Y[Q]=H,h&&(D[Q]=(lt.geodeticLatitudeToMercatorAngle(E)-T)*S),b){let t=n.geodeticSurfaceNormal(H);K[Q]=t}$.multiplyByPoint(R,H,G),P.minimumByComponent(G,y,y),P.maximumByComponent(G,B,B);let _=(f-m)/(p-m);_=r.clamp(_,0,1);let j=(E-g)/(I-g);j=r.clamp(j,0,1),L[Q]=new wt(_,j),++Q}let _=3*E;for(let t=0;t<_;++t,++et)z[et]=k[A.getUint16(O,!0)],O+=$t;if(v!==O-t)throw new Ht("Invalid terrain tile.")}Y.length=Q,L.length=Q,V.length=Q,h&&(D.length=Q),b&&(K.length=Q);let nt=Q,it=et,rt={hMin:M,lastBorderPoint:void 0,skirtHeight:l,toENU:R,ellipsoid:n,minimum:y,maximum:B};X.sort(function(t,e){return e.cartographic.latitude-t.cartographic.latitude}),Z.sort(function(t,e){return t.cartographic.longitude-e.cartographic.longitude}),q.sort(function(t,e){return t.cartographic.latitude-e.cartographic.latitude}),J.sort(function(t,e){return e.cartographic.longitude-t.cartographic.longitude});let ot=1e-5;if(gt(Y,V,L,D,K,z,rt,X,-ot*f,!0,-ot*E),gt(Y,V,L,D,K,z,rt,Z,-ot*E,!1),gt(Y,V,L,D,K,z,rt,q,ot*f,!0,ot*E),gt(Y,V,L,D,K,z,rt,J,ot*E,!1),X.length>0&&J.length>0){let t=X[0].index,e=nt,n=J[J.length-1].index,i=Y.length-1;z.push(n,i,e,e,t,n)}j=Y.length;let at,ut=zt.fromPoints(Y);ht(i)&&(at=qt.fromRectangle(i,M,F,n));let st=new Dt(n).computeHorizonCullingPointPossiblyUnderEllipsoid(e,Y,M),ct=new kt(y,B,e),dt=new Gt(e,ct,rt.hMin,F,k,!1,h,b,a,s),pt=new Float32Array(j*dt.stride),It=0;for(let t=0;t<j;++t)It=dt.encode(pt,It,Y[t],L[t],V[t],void 0,D[t],K[t]);let Nt=X.map(function(t){return t.index}).reverse(),ft=Z.map(function(t){return t.index}).reverse(),Et=q.map(function(t){return t.index}).reverse(),Tt=J.map(function(t){return t.index}).reverse();return ft.unshift(Et[Et.length-1]),ft.push(Nt[0]),Tt.unshift(Nt[Nt.length-1]),Tt.push(Et[0]),{vertices:pt,indices:new Uint16Array(z),maximumHeight:F,minimumHeight:M,encoding:dt,boundingSphere3D:ut,orientedBoundingBox:at,occludeePointInScaledSpace:st,vertexCountWithoutSkirts:nt,indexCountWithoutSkirts:it,westIndicesSouthToNorth:Nt,southIndicesEastToWest:ft,eastIndicesNorthToSouth:Et,northIndicesWestToEast:Tt}}function gt(t,e,n,i,o,a,s,l,h,c,d){let m=l.length;for(let g=0;g<m;++g){let p=l[g],I=p.cartographic,f=p.index,E=t.length,T=I.longitude,S=I.latitude;S=r.clamp(S,-r.PI_OVER_TWO,r.PI_OVER_TWO);let x=I.height-s.skirtHeight;s.hMin=Math.min(s.hMin,x),N.fromRadians(T,S,x,u),c&&(u.longitude+=h),c?g===m-1?u.latitude+=d:0===g&&(u.latitude-=d):u.latitude+=h;let w=s.ellipsoid.cartographicToCartesian(u);t.push(w),e.push(x),n.push(wt.clone(n[f])),i.length>0&&i.push(i[f]),o.length>0&&o.push(o[f]),$.multiplyByPoint(s.toENU,w,G);let k=s.minimum,R=s.maximum;P.minimumByComponent(G,k,k),P.maximumByComponent(G,R,R);let b=s.lastBorderPoint;if(ht(b)){let t=b.index;a.push(t,E-1,E,E,f,t)}s.lastBorderPoint=p}}var we=Lt(ee);export{we as default};