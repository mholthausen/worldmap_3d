/*! For license information please see createVerticesFromGoogleEarthEnterpriseBuffer.js.LICENSE.txt */
import{a as Gt,b as Xt}from"./chunk-HCYU7WEB.js";import{a as kt}from"./chunk-R7GRRUJS.js";import{a as lt}from"./chunk-Q3ITDG7Y.js";import{a as Dt}from"./chunk-HRTRKKEE.js";import"./chunk-FZIR7YHL.js";import"./chunk-JATOGJGF.js";import{a as qt}from"./chunk-U54QHQ4X.js";import"./chunk-EQAHH27B.js";import"./chunk-LWO5EUNN.js";import{d as zt,h as Lt}from"./chunk-LYPPBP4Q.js";import"./chunk-PCFGFNNQ.js";import"./chunk-V2SDNSQR.js";import{b as $,c as Ot}from"./chunk-S7TTFAYA.js";import"./chunk-TLYHKSDJ.js";import{a as P,b as N,c as wt,d as Ht}from"./chunk-PYVDHCDQ.js";import{a as r}from"./chunk-JMWWNZHX.js";import"./chunk-DNO4OWAM.js";import{a as Vt}from"./chunk-XDVDNOI4.js";import{a as Ut}from"./chunk-Z3SYNMQT.js";import"./chunk-4KGDZUZQ.js";import{e as ht}from"./chunk-F3TINEFX.js";var te=Uint16Array.BYTES_PER_ELEMENT,mt=Int32Array.BYTES_PER_ELEMENT,Pt=Uint32Array.BYTES_PER_ELEMENT,ee=Float32Array.BYTES_PER_ELEMENT,H=Float64Array.BYTES_PER_ELEMENT;function tt(t,e,n){n=Ut(n,r);let i=t.length;for(let o=0;o<i;++o)if(n.equalsEpsilon(t[o],e,r.EPSILON12))return o;return-1}function oe(t,e){t.ellipsoid=Ht.clone(t.ellipsoid),t.rectangle=Ot.clone(t.rectangle);let n=se(t.buffer,t.relativeToCenter,t.ellipsoid,t.rectangle,t.nativeRectangle,t.exaggeration,t.exaggerationRelativeHeight,t.skirtHeight,t.includeWebMercatorT,t.negativeAltitudeExponentBias,t.negativeElevationThreshold),i=n.vertices;e.push(i.buffer);let r=n.indices;return e.push(r.buffer),{vertices:i.buffer,indices:r.buffer,numberOfAttributes:n.encoding.stride,minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight,boundingSphere3D:n.boundingSphere3D,orientedBoundingBox:n.orientedBoundingBox,occludeePointInScaledSpace:n.occludeePointInScaledSpace,encoding:n.encoding,vertexCountWithoutSkirts:n.vertexCountWithoutSkirts,indexCountWithoutSkirts:n.indexCountWithoutSkirts,westIndicesSouthToNorth:n.westIndicesSouthToNorth,southIndicesEastToWest:n.southIndicesEastToWest,eastIndicesNorthToSouth:n.eastIndicesNorthToSouth,northIndicesWestToEast:n.northIndicesWestToEast}}var u=new N,G=new P,ne=new P,ie=new P,re=new $;function se(t,e,n,i,o,a,s,l,h,c,m){let d,g,p,I,E,T;ht(i)?(d=i.west,g=i.south,p=i.east,I=i.north,E=i.width,T=i.height):(d=r.toRadians(o.west),g=r.toRadians(o.south),p=r.toRadians(o.east),I=r.toRadians(o.north),E=r.toRadians(i.width),T=r.toRadians(i.height));let f,S,x=[g,I],w=[d,p],k=Lt.eastNorthUpToFixedFrame(e,n),A=$.inverseTransformation(k,re);h&&(f=lt.geodeticLatitudeToMercatorAngle(g),S=1/(lt.geodeticLatitudeToMercatorAngle(I)-f));let R=1!==a,b=new DataView(t),F=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,B=ne;B.x=Number.POSITIVE_INFINITY,B.y=Number.POSITIVE_INFINITY,B.z=Number.POSITIVE_INFINITY;let M=ie;M.x=Number.NEGATIVE_INFINITY,M.y=Number.NEGATIVE_INFINITY,M.z=Number.NEGATIVE_INFINITY;let v,_,j=0,Y=0,W=0;for(_=0;_<4;++_){let t=j;v=b.getUint32(t,!0),t+=Pt;let e=r.toRadians(180*b.getFloat64(t,!0));t+=H,-1===tt(w,e)&&w.push(e);let n=r.toRadians(180*b.getFloat64(t,!0));t+=H,-1===tt(x,n)&&x.push(n),t+=2*H;let i=b.getInt32(t,!0);t+=mt,Y+=i,i=b.getInt32(t,!0),W+=3*i,j+=v+Pt}let U=[],C=[],O=new Array(Y),V=new Array(Y),D=new Array(Y),L=h?new Array(Y):[],Q=R?new Array(Y):[],X=new Array(W),z=[],J=[],Z=[],K=[],q=0,et=0;for(j=0,_=0;_<4;++_){v=b.getUint32(j,!0),j+=Pt;let t=j,e=r.toRadians(180*b.getFloat64(j,!0));j+=H;let i=r.toRadians(180*b.getFloat64(j,!0));j+=H;let o=r.toRadians(180*b.getFloat64(j,!0)),a=.5*o;j+=H;let s=r.toRadians(180*b.getFloat64(j,!0)),l=.5*s;j+=H;let E=b.getInt32(j,!0);j+=mt;let T=b.getInt32(j,!0);j+=mt,j+=mt;let k=new Array(E);for(let t=0;t<E;++t){let E=e+b.getUint8(j++)*o;u.longitude=E;let T=i+b.getUint8(j++)*s;u.latitude=T;let H=b.getFloat32(j,!0);if(j+=ee,0!==H&&H<m&&(H*=-Math.pow(2,c)),H*=6371010,u.height=H,-1!==tt(w,E)||-1!==tt(x,T)){let e=tt(U,u,N);if(-1!==e){k[t]=C[e];continue}U.push(N.clone(u)),C.push(q)}k[t]=q,Math.abs(E-d)<a?z.push({index:q,cartographic:N.clone(u)}):Math.abs(E-p)<a?Z.push({index:q,cartographic:N.clone(u)}):Math.abs(T-g)<l?J.push({index:q,cartographic:N.clone(u)}):Math.abs(T-I)<l&&K.push({index:q,cartographic:N.clone(u)}),F=Math.min(H,F),y=Math.max(H,y),D[q]=H;let v=n.cartographicToCartesian(u);if(O[q]=v,h&&(L[q]=(lt.geodeticLatitudeToMercatorAngle(T)-f)*S),R){let t=n.geodeticSurfaceNormal(v);Q[q]=t}$.multiplyByPoint(A,v,G),P.minimumByComponent(G,B,B),P.maximumByComponent(G,M,M);let _=(E-d)/(p-d);_=r.clamp(_,0,1);let Y=(T-g)/(I-g);Y=r.clamp(Y,0,1),V[q]=new wt(_,Y),++q}let _=3*T;for(let t=0;t<_;++t,++et)X[et]=k[b.getUint16(j,!0)],j+=te;if(v!==j-t)throw new Vt("Invalid terrain tile.")}O.length=q,V.length=q,D.length=q,h&&(L.length=q),R&&(Q.length=q);let nt=q,it=et,rt={hMin:F,lastBorderPoint:void 0,skirtHeight:l,toENU:A,ellipsoid:n,minimum:B,maximum:M};z.sort((function(t,e){return e.cartographic.latitude-t.cartographic.latitude})),J.sort((function(t,e){return t.cartographic.longitude-e.cartographic.longitude})),Z.sort((function(t,e){return t.cartographic.latitude-e.cartographic.latitude})),K.sort((function(t,e){return e.cartographic.longitude-t.cartographic.longitude}));let ot=1e-5;if(gt(O,D,V,L,Q,X,rt,z,-ot*E,!0,-ot*T),gt(O,D,V,L,Q,X,rt,J,-ot*T,!1),gt(O,D,V,L,Q,X,rt,Z,ot*E,!0,ot*T),gt(O,D,V,L,Q,X,rt,K,ot*T,!1),z.length>0&&K.length>0){let t=z[0].index,e=nt,n=K[K.length-1].index,i=O.length-1;X.push(n,i,e,e,t,n)}Y=O.length;let at,ut=zt.fromPoints(O);ht(i)&&(at=Dt.fromRectangle(i,F,y,n));let st=new Gt(n).computeHorizonCullingPointPossiblyUnderEllipsoid(e,O,F),ct=new qt(B,M,e),dt=new Xt(e,ct,rt.hMin,y,k,!1,h,R,a,s),pt=new Float32Array(Y*dt.stride),It=0;for(let t=0;t<Y;++t)It=dt.encode(pt,It,O[t],V[t],D[t],void 0,L[t],Q[t]);let Nt=z.map((function(t){return t.index})).reverse(),Et=J.map((function(t){return t.index})).reverse(),Tt=Z.map((function(t){return t.index})).reverse(),ft=K.map((function(t){return t.index})).reverse();return Et.unshift(Tt[Tt.length-1]),Et.push(Nt[0]),ft.unshift(Nt[Nt.length-1]),ft.push(Tt[0]),{vertices:pt,indices:new Uint16Array(X),maximumHeight:y,minimumHeight:F,encoding:dt,boundingSphere3D:ut,orientedBoundingBox:at,occludeePointInScaledSpace:st,vertexCountWithoutSkirts:nt,indexCountWithoutSkirts:it,westIndicesSouthToNorth:Nt,southIndicesEastToWest:Et,eastIndicesNorthToSouth:Tt,northIndicesWestToEast:ft}}function gt(t,e,n,i,o,a,s,l,h,c,m){let d=l.length;for(let g=0;g<d;++g){let p=l[g],I=p.cartographic,E=p.index,T=t.length,f=I.longitude,S=I.latitude;S=r.clamp(S,-r.PI_OVER_TWO,r.PI_OVER_TWO);let x=I.height-s.skirtHeight;s.hMin=Math.min(s.hMin,x),N.fromRadians(f,S,x,u),c&&(u.longitude+=h),c?g===d-1?u.latitude+=m:0===g&&(u.latitude-=m):u.latitude+=h;let w=s.ellipsoid.cartographicToCartesian(u);t.push(w),e.push(x),n.push(wt.clone(n[E])),i.length>0&&i.push(i[E]),o.length>0&&o.push(o[E]),$.multiplyByPoint(s.toENU,w,G);let k=s.minimum,A=s.maximum;P.minimumByComponent(G,k,k),P.maximumByComponent(G,A,A);let H=s.lastBorderPoint;if(ht(H)){let t=H.index;a.push(t,T-1,T,T,E,t)}s.lastBorderPoint=p}}var Ae=kt(oe);export{Ae as default};