/*! For license information please see createVectorTilePolygons.js.LICENSE.txt */
import{a as R}from"./chunk-6ITL4SKA.js";import{a as It}from"./chunk-2SKW2VRQ.js";import{a as M}from"./chunk-PYQRNF73.js";import{a as bt}from"./chunk-IYTTCRXN.js";import"./chunk-QCBYIBZJ.js";import"./chunk-5XT3QCZD.js";import"./chunk-ZKNXHPHD.js";import"./chunk-W5ZMPE2M.js";import{a as W}from"./chunk-EQ7PMEBC.js";import"./chunk-YIFABOF6.js";import"./chunk-PQVQONHO.js";import{c as z}from"./chunk-KDW4RGIR.js";import"./chunk-VNDUYYBJ.js";import{a as o,b as nt,c as j}from"./chunk-V624RX7A.js";import{a as et}from"./chunk-VZ2RFJ3P.js";import"./chunk-RN5GA5QZ.js";import"./chunk-TWC6ISJU.js";import"./chunk-RKPKWH3Z.js";import"./chunk-BIYNNQRQ.js";import{e as A}from"./chunk-ZLUSVROX.js";var kt=new o,Bt=new j,Nt=new z,E={min:void 0,max:void 0,indexBytesPerElement:void 0};function Pt(t){let e=new Float64Array(t),n=0;E.indexBytesPerElement=e[n++],E.min=e[n++],E.max=e[n++],o.unpack(e,n,kt),n+=o.packedLength,j.unpack(e,n,Bt),n+=j.packedLength,z.unpack(e,n,Nt)}function Tt(t){let e=t.length,n=0;for(let r=0;r<e;++r)n+=R.packedLength+3+t[r].batchIds.length;return n}function Ct(t,e,n){let r=e.length,o=2+r*M.packedLength+1+Tt(n),a=new Float64Array(o),i=0;a[i++]=t,a[i++]=r;for(let t=0;t<r;++t)M.pack(e[t],a,i),i+=M.packedLength;let s=n.length;a[i++]=s;for(let t=0;t<s;++t){let e=n[t];R.pack(e.color,a,i),i+=R.packedLength,a[i++]=e.offset,a[i++]=e.count;let r=e.batchIds,o=r.length;a[i++]=o;for(let t=0;t<o;++t)a[i++]=r[t]}return a}var yt=32767,wt=new o,Ht=new o,St=new o,Ut=new o,Ft=new o,Lt=new nt,Mt=new z;function Rt(t,e){let n;Pt(t.packedBuffer),n=2===E.indexBytesPerElement?new Uint16Array(t.indices):new Uint32Array(t.indices);let r=new Uint16Array(t.positions),a=new Uint32Array(t.counts),i=new Uint32Array(t.indexCounts),s=new Uint32Array(t.batchIds),f=new Uint32Array(t.batchTableColors),c=new Array(a.length),h=kt,l=Bt,u=Nt,m=E.min,p=E.max,d=t.minimumHeights,k=t.maximumHeights;A(d)&&A(k)&&(d=new Float32Array(d),k=new Float32Array(k));let I,g,w,b=r.length/2,y=r.subarray(0,b),N=r.subarray(b,2*b);bt.zigZagDeltaDecode(y,N);let j=new Float64Array(3*b);for(I=0;I<b;++I){let t=y[I],e=N[I],n=et.lerp(u.west,u.east,t/yt),r=et.lerp(u.south,u.north,e/yt),a=nt.fromRadians(n,r,0,Lt),i=l.cartographicToCartesian(a,wt);o.pack(i,j,3*I)}let T=a.length,x=new Array(T),L=new Array(T),B=0,P=0;for(I=0;I<T;++I)x[I]=B,L[I]=P,B+=a[I],P+=i[I];let U=new Float32Array(3*b*2),F=new Uint16Array(2*b),S=new Uint32Array(L.length),O=new Uint32Array(i.length),C=[],Y={};for(I=0;I<T;++I)w=f[I],A(Y[w])?(Y[w].positionLength+=a[I],Y[w].indexLength+=i[I],Y[w].batchIds.push(I)):Y[w]={positionLength:a[I],indexLength:i[I],offset:0,indexOffset:0,batchIds:[I]};let Q,V=0,H=0;for(w in Y)if(Y.hasOwnProperty(w)){Q=Y[w],Q.offset=V,Q.indexOffset=H;let t=2*Q.positionLength,e=2*Q.indexLength+6*Q.positionLength;V+=t,H+=e,Q.indexLength=e}let Z=[];for(w in Y)Y.hasOwnProperty(w)&&(Q=Y[w],Z.push({color:R.fromRgba(parseInt(w)),offset:Q.indexOffset,count:Q.indexLength,batchIds:Q.batchIds}));for(I=0;I<T;++I){w=f[I],Q=Y[w];let t=Q.offset,e=3*t,r=t,b=x[I],y=a[I],N=s[I],E=m,T=p;A(d)&&A(k)&&(E=d[I],T=k[I]);let R=Number.POSITIVE_INFINITY,B=Number.NEGATIVE_INFINITY,P=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY;for(g=0;g<y;++g){let t=o.unpack(j,3*b+3*g,wt);l.scaleToGeodeticSurface(t,t);let n=l.cartesianToCartographic(t,Lt),a=n.latitude,i=n.longitude;R=Math.min(a,R),B=Math.max(a,B),P=Math.min(i,P),V=Math.max(i,V);let s=l.geodeticSurfaceNormal(t,Ht),f=o.multiplyByScalar(s,E,St),c=o.add(t,f,Ut);f=o.multiplyByScalar(s,T,f);let u=o.add(t,f,Ft);o.subtract(u,h,u),o.subtract(c,h,c),o.pack(u,U,e),o.pack(c,U,e+3),F[r]=N,F[r+1]=N,e+=6,r+=2}u=Mt,u.west=P,u.east=V,u.south=R,u.north=B,c[I]=M.fromRectangle(u,m,p,l);let H=Q.indexOffset,W=L[I],Z=i[I];for(S[I]=H,g=0;g<Z;g+=3){let e=n[W+g]-b,r=n[W+g+1]-b,o=n[W+g+2]-b;C[H++]=2*e+t,C[H++]=2*r+t,C[H++]=2*o+t,C[H++]=2*o+1+t,C[H++]=2*r+1+t,C[H++]=2*e+1+t}for(g=0;g<y;++g){let e=g,n=(g+1)%y;C[H++]=2*e+1+t,C[H++]=2*n+t,C[H++]=2*e+t,C[H++]=2*e+1+t,C[H++]=2*n+1+t,C[H++]=2*n+t}Q.offset+=2*y,Q.indexOffset=H,O[I]=H-S[I]}C=W.createTypedArray(U.length/3,C);let D=Z.length;for(let t=0;t<D;++t){let e=Z[t].batchIds,n=0,r=e.length;for(let t=0;t<r;++t)n+=O[e[t]];Z[t].count=n}let _=Ct(2===C.BYTES_PER_ELEMENT?W.UNSIGNED_SHORT:W.UNSIGNED_INT,c,Z);return e.push(U.buffer,C.buffer,S.buffer,O.buffer,F.buffer,_.buffer),{positions:U.buffer,indices:C.buffer,indexOffsets:S.buffer,indexCounts:O.buffer,batchIds:F.buffer,packedBuffer:_.buffer}}var Jt=It(Rt);export{Jt as default};