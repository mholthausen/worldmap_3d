define(["./when-ad3237a0","./Cartesian2-08065eec","./Transforms-1142ce48","./ComponentDatatype-a867ddaa","./Check-be2d5acb","./GeometryAttribute-da891979","./GeometryAttributes-27dc652d","./IndexDatatype-9504f550","./Math-5ca9b250","./VertexFormat-fc4fc84a","./WallGeometryLibrary-f1723c04","./combine-1510933d","./RuntimeError-767bd866","./WebGLConstants-1c8239cc","./arrayRemoveDuplicates-707c233c","./PolylinePipeline-05927ee2","./EllipsoidGeodesic-dc284f08","./EllipsoidRhumbLine-4a6ed5de","./IntersectionTests-75083888","./Plane-bb88dd7e"],(function(e,t,a,i,n,r,o,s,m,l,d,u,p,c,y,g,f,h,C,v){"use strict";var x=new t.Cartesian3,b=new t.Cartesian3,A=new t.Cartesian3,_=new t.Cartesian3,E=new t.Cartesian3,w=new t.Cartesian3,F=new t.Cartesian3;function L(a){var i=(a=e.defaultValue(a,e.defaultValue.EMPTY_OBJECT)).positions,n=a.maximumHeights,r=a.minimumHeights,o=e.defaultValue(a.vertexFormat,l.VertexFormat.DEFAULT),s=e.defaultValue(a.granularity,m.CesiumMath.RADIANS_PER_DEGREE);a=e.defaultValue(a.ellipsoid,t.Ellipsoid.WGS84),this._positions=i,this._minimumHeights=r,this._maximumHeights=n,this._vertexFormat=l.VertexFormat.clone(o),this._granularity=s,this._ellipsoid=t.Ellipsoid.clone(a),this._workerName="createWallGeometry",i=1+i.length*t.Cartesian3.packedLength+2,e.defined(r)&&(i+=r.length),e.defined(n)&&(i+=n.length),this.packedLength=i+t.Ellipsoid.packedLength+l.VertexFormat.packedLength+1}L.pack=function(a,i,n){var r;n=e.defaultValue(n,0);var o=a._positions,s=o.length;for(i[n++]=s,r=0;r<s;++r,n+=t.Cartesian3.packedLength)t.Cartesian3.pack(o[r],i,n);var m=a._minimumHeights;if(s=e.defined(m)?m.length:0,i[n++]=s,e.defined(m))for(r=0;r<s;++r)i[n++]=m[r];var d=a._maximumHeights;if(s=e.defined(d)?d.length:0,i[n++]=s,e.defined(d))for(r=0;r<s;++r)i[n++]=d[r];return t.Ellipsoid.pack(a._ellipsoid,i,n),n+=t.Ellipsoid.packedLength,l.VertexFormat.pack(a._vertexFormat,i,n),i[n+=l.VertexFormat.packedLength]=a._granularity,i};var k=t.Ellipsoid.clone(t.Ellipsoid.UNIT_SPHERE),H=new l.VertexFormat,V={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:k,vertexFormat:H,granularity:void 0};return L.unpack=function(a,i,n){i=e.defaultValue(i,0);for(var r,o,s=a[i++],m=new Array(s),d=0;d<s;++d,i+=t.Cartesian3.packedLength)m[d]=t.Cartesian3.unpack(a,i);if(0<(s=a[i++]))for(r=new Array(s),d=0;d<s;++d)r[d]=a[i++];if(0<(s=a[i++]))for(o=new Array(s),d=0;d<s;++d)o[d]=a[i++];var u=t.Ellipsoid.unpack(a,i,k);i+=t.Ellipsoid.packedLength;var p=l.VertexFormat.unpack(a,i,H),c=a[i+=l.VertexFormat.packedLength];return e.defined(n)?(n._positions=m,n._minimumHeights=r,n._maximumHeights=o,n._ellipsoid=t.Ellipsoid.clone(u,n._ellipsoid),n._vertexFormat=l.VertexFormat.clone(p,n._vertexFormat),n._granularity=c,n):(V.positions=m,V.minimumHeights=r,V.maximumHeights=o,V.granularity=c,new L(V))},L.fromConstantHeights=function(t){var a=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions,i=t.minimumHeight,n=t.maximumHeight,r=e.defined(i),o=e.defined(n);if(r||o)for(var s=a.length,m=r?new Array(s):void 0,l=o?new Array(s):void 0,d=0;d<s;++d)r&&(m[d]=i),o&&(l[d]=n);return new L({positions:a,maximumHeights:l,minimumHeights:m,ellipsoid:t.ellipsoid,vertexFormat:t.vertexFormat})},L.createGeometry=function(n){var l=n._positions,u=n._minimumHeights,p=n._maximumHeights,c=n._vertexFormat,y=n._granularity,g=n._ellipsoid;if(p=d.WallGeometryLibrary.computePositions(g,l,p,u,y,!0),e.defined(p)){for(var f=p.bottomPositions,h=p.topPositions,C=(u=p.numCorners,h.length),v=(y=2*C,c.position?new Float64Array(y):void 0),L=c.normal?new Float32Array(y):void 0,k=c.tangent?new Float32Array(y):void 0,H=c.bitangent?new Float32Array(y):void 0,V=c.st?new Float32Array(y/3*2):void 0,G=0,D=0,P=0,T=0,z=0,O=F,R=w,S=E,I=!0,N=0,M=1/((C/=3)-u-1),W=0;W<C;++W){var B,U=3*W,q=t.Cartesian3.fromArray(h,U,x),J=t.Cartesian3.fromArray(f,U,b);c.position&&(v[G++]=J.x,v[G++]=J.y,v[G++]=J.z,v[G++]=q.x,v[G++]=q.y,v[G++]=q.z),c.st&&(V[z++]=N,V[z++]=0,V[z++]=N,V[z++]=1),(c.normal||c.tangent||c.bitangent)&&(B=t.Cartesian3.clone(t.Cartesian3.ZERO,_),J=t.Cartesian3.subtract(q,g.geodeticSurfaceNormal(q,b),b),W+1<C&&(B=t.Cartesian3.fromArray(h,3+U,_)),I&&(U=t.Cartesian3.subtract(B,q,A),J=t.Cartesian3.subtract(J,q,x),O=t.Cartesian3.normalize(t.Cartesian3.cross(J,U,O),O),I=!1),t.Cartesian3.equalsEpsilon(q,B,m.CesiumMath.EPSILON10)?I=!0:(N+=M,c.tangent&&(R=t.Cartesian3.normalize(t.Cartesian3.subtract(B,q,R),R)),c.bitangent&&(S=t.Cartesian3.normalize(t.Cartesian3.cross(O,R,S),S))),c.normal&&(L[D++]=O.x,L[D++]=O.y,L[D++]=O.z,L[D++]=O.x,L[D++]=O.y,L[D++]=O.z),c.tangent&&(k[T++]=R.x,k[T++]=R.y,k[T++]=R.z,k[T++]=R.x,k[T++]=R.y,k[T++]=R.z),c.bitangent&&(H[P++]=S.x,H[P++]=S.y,H[P++]=S.z,H[P++]=S.x,H[P++]=S.y,H[P++]=S.z))}p=new o.GeometryAttributes,c.position&&(p.position=new r.GeometryAttribute({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:v})),c.normal&&(p.normal=new r.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:L})),c.tangent&&(p.tangent=new r.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),c.bitangent&&(p.bitangent=new r.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:H})),c.st&&(p.st=new r.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:V}));var Y=y/3,Z=s.IndexDatatype.createTypedArray(Y,y-=6*(u+1)),j=0;for(W=0;W<Y-2;W+=2){var K=W,Q=W+2,X=t.Cartesian3.fromArray(v,3*K,x),$=t.Cartesian3.fromArray(v,3*Q,b);t.Cartesian3.equalsEpsilon(X,$,m.CesiumMath.EPSILON10)||($=W+3,Z[j++]=W+1,Z[j++]=K,Z[j++]=$,Z[j++]=$,Z[j++]=K,Z[j++]=Q)}return new r.Geometry({attributes:p,indices:Z,primitiveType:r.PrimitiveType.TRIANGLES,boundingSphere:new a.BoundingSphere.fromVertices(v)})}},function(a,i){return(a=e.defined(i)?L.unpack(a,i):a)._ellipsoid=t.Ellipsoid.clone(a._ellipsoid),L.createGeometry(a)}}));