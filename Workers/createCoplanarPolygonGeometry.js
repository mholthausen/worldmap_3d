define(["./arrayRemoveDuplicates-707c233c","./BoundingRectangle-8fed902e","./Transforms-1142ce48","./Cartesian2-08065eec","./Check-be2d5acb","./ComponentDatatype-a867ddaa","./CoplanarPolygonGeometryLibrary-cd5a1869","./when-ad3237a0","./GeometryAttribute-da891979","./GeometryAttributes-27dc652d","./GeometryInstance-42129c83","./GeometryPipeline-3334f964","./IndexDatatype-9504f550","./Math-5ca9b250","./PolygonGeometryLibrary-967e68c5","./PolygonPipeline-ac773b7c","./VertexFormat-fc4fc84a","./combine-1510933d","./RuntimeError-767bd866","./WebGLConstants-1c8239cc","./OrientedBoundingBox-2cc6ca57","./EllipsoidTangentPlane-f8b1fc8b","./AxisAlignedBoundingBox-718a9087","./IntersectionTests-75083888","./Plane-bb88dd7e","./AttributeCompression-9fbb8447","./EncodedCartesian3-a785c24c","./ArcType-98ec98bf","./EllipsoidRhumbLine-4a6ed5de"],(function(e,t,n,a,r,o,i,l,s,c,p,y,m,u,d,g,b,h,C,v,x,f,P,A,w,F,G,L,E){"use strict";var T=new a.Cartesian3,D=new t.BoundingRectangle,_=new a.Cartesian2,k=new a.Cartesian2,V=new a.Cartesian3,R=new a.Cartesian3,I=new a.Cartesian3,M=new a.Cartesian3,B=new a.Cartesian3,H=new a.Cartesian3,O=new n.Quaternion,z=new n.Matrix3,S=new n.Matrix3,N=new a.Cartesian3;function Q(e){var t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy,n=l.defaultValue(e.vertexFormat,b.VertexFormat.DEFAULT);this._vertexFormat=b.VertexFormat.clone(n),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=a.Ellipsoid.clone(l.defaultValue(e.ellipsoid,a.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=d.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+b.VertexFormat.packedLength+a.Ellipsoid.packedLength+2}Q.fromPositions=function(e){return new Q({polygonHierarchy:{positions:(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},Q.pack=function(e,t,n){return n=l.defaultValue(n,0),n=d.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,n),a.Ellipsoid.pack(e._ellipsoid,t,n),n+=a.Ellipsoid.packedLength,b.VertexFormat.pack(e._vertexFormat,t,n),n+=b.VertexFormat.packedLength,t[n++]=e._stRotation,t[n]=e.packedLength,t};var j=a.Ellipsoid.clone(a.Ellipsoid.UNIT_SPHERE),U=new b.VertexFormat,Y={polygonHierarchy:{}};return Q.unpack=function(e,t,n){t=l.defaultValue(t,0);var r=d.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=a.Ellipsoid.unpack(e,t,j);t+=a.Ellipsoid.packedLength;var i=b.VertexFormat.unpack(e,t,U);t+=b.VertexFormat.packedLength;var s=e[t++];return t=e[t],(n=l.defined(n)?n:new Q(Y))._polygonHierarchy=r,n._ellipsoid=a.Ellipsoid.clone(o,n._ellipsoid),n._vertexFormat=b.VertexFormat.clone(i,n._vertexFormat),n._stRotation=s,n.packedLength=t,n},Q.createGeometry=function(t){var r=t._vertexFormat,l=t._polygonHierarchy,b=t._stRotation,h=l.positions;if(!((h=e.arrayRemoveDuplicates(h,a.Cartesian3.equalsEpsilon,!0)).length<3)){var C=V,v=R,x=I,f=B,P=H;if(i.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(h,M,f,P)){C=a.Cartesian3.cross(f,P,C),C=a.Cartesian3.normalize(C,C),a.Cartesian3.equalsEpsilon(M,a.Cartesian3.ZERO,u.CesiumMath.EPSILON6)||(A=t._ellipsoid.geodeticSurfaceNormal(M,N),a.Cartesian3.dot(C,A)<0&&(C=a.Cartesian3.negate(C,C),f=a.Cartesian3.negate(f,f)));var A=i.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(M,f,P),w=i.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(M,f,P);r.tangent&&(v=a.Cartesian3.clone(f,v)),r.bitangent&&(x=a.Cartesian3.clone(P,x)),A=(l=d.PolygonGeometryLibrary.polygonsFromHierarchy(l,A,!1)).hierarchy;var F=l.polygons;if(0!==A.length){h=A[0].outerRing,l=n.BoundingSphere.fromPoints(h);for(var G=d.PolygonGeometryLibrary.computeBoundingRectangle(C,w,h,b,D),L=[],E=0;E<F.length;E++){var Q=new p.GeometryInstance({geometry:function(e,t,r,i,l,p,y,d){var b=e.positions,h=g.PolygonPipeline.triangulate(e.positions2D,e.holes);h.length<3&&(h=[0,1,2]),(e=m.IndexDatatype.createTypedArray(b.length,h.length)).set(h);var C=z;0!==i?(h=n.Quaternion.fromAxisAngle(p,i,O),C=n.Matrix3.fromQuaternion(h,C),(t.tangent||t.bitangent)&&(h=n.Quaternion.fromAxisAngle(p,-i,O),f=n.Matrix3.fromQuaternion(h,S),y=a.Cartesian3.normalize(n.Matrix3.multiplyByVector(f,y,y),y),t.bitangent&&(d=a.Cartesian3.normalize(a.Cartesian3.cross(p,y,d),d)))):C=n.Matrix3.clone(n.Matrix3.IDENTITY,C);var v=k;t.st&&(v.x=r.x,v.y=r.y);for(var x=b.length,f=3*x,P=new Float64Array(f),A=t.normal?new Float32Array(f):void 0,w=t.tangent?new Float32Array(f):void 0,F=t.bitangent?new Float32Array(f):void 0,G=t.st?new Float32Array(2*x):void 0,L=0,E=0,D=0,V=0,R=0,I=0;I<x;I++){var M,B=b[I];P[L++]=B.x,P[L++]=B.y,P[L++]=B.z,t.st&&(M=l(n.Matrix3.multiplyByVector(C,B,T),_),a.Cartesian2.subtract(M,v,M),B=u.CesiumMath.clamp(M.x/r.width,0,1),M=u.CesiumMath.clamp(M.y/r.height,0,1),G[R++]=B,G[R++]=M),t.normal&&(A[E++]=p.x,A[E++]=p.y,A[E++]=p.z),t.tangent&&(w[V++]=y.x,w[V++]=y.y,w[V++]=y.z),t.bitangent&&(F[D++]=d.x,F[D++]=d.y,F[D++]=d.z)}return f=new c.GeometryAttributes,t.position&&(f.position=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:P})),t.normal&&(f.normal=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),t.tangent&&(f.tangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})),t.bitangent&&(f.bitangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:F})),t.st&&(f.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:G})),new s.Geometry({attributes:f,indices:e,primitiveType:s.PrimitiveType.TRIANGLES})}(F[E],r,G,b,w,C,v,x)});L.push(Q)}return(A=y.GeometryPipeline.combineInstances(L)[0]).attributes.position.values=new Float64Array(A.attributes.position.values),A.indices=m.IndexDatatype.createTypedArray(A.attributes.position.values.length/3,A.indices),h=A.attributes,r.position||delete h.position,new s.Geometry({attributes:h,indices:A.indices,primitiveType:A.primitiveType,boundingSphere:l})}}}},function(e,t){return l.defined(t)&&(e=Q.unpack(e,t)),Q.createGeometry(e)}}));