define(["./when-ad3237a0","./Cartesian2-08065eec","./ArcType-98ec98bf","./GeometryOffsetAttribute-03006e80","./BoundingRectangle-8fed902e","./Transforms-1142ce48","./Check-be2d5acb","./ComponentDatatype-a867ddaa","./EllipsoidGeodesic-dc284f08","./EllipsoidTangentPlane-f8b1fc8b","./GeometryAttribute-da891979","./GeometryInstance-42129c83","./GeometryPipeline-3334f964","./IndexDatatype-9504f550","./Math-5ca9b250","./PolygonGeometryLibrary-967e68c5","./PolygonPipeline-ac773b7c","./VertexFormat-fc4fc84a","./combine-1510933d","./RuntimeError-767bd866","./WebGLConstants-1c8239cc","./AxisAlignedBoundingBox-718a9087","./IntersectionTests-75083888","./Plane-bb88dd7e","./AttributeCompression-9fbb8447","./EncodedCartesian3-a785c24c","./arrayRemoveDuplicates-707c233c","./EllipsoidRhumbLine-4a6ed5de","./GeometryAttributes-27dc652d"],(function(e,t,r,o,a,i,n,s,l,u,c,p,m,y,g,d,h,f,b,_,v,P,C,x,w,T,I,A,E){"use strict";var G=new t.Cartographic,O=new t.Cartographic,V=new a.BoundingRectangle,F=new t.Cartesian3,D=new t.Cartesian3,L=new t.Cartesian3,N=new t.Cartesian3,H=new t.Cartesian3,R=new t.Cartesian3,M=new t.Cartesian3,S=new t.Cartesian3,B=new t.Cartesian3,k=new t.Cartesian2,z=new t.Cartesian2,W=new t.Cartesian3,Y=new i.Quaternion,U=new i.Matrix3,j=new i.Matrix3;function Q(r){var a,n=r.vertexFormat,l=r.geometry,u=r.shadowVolume,p=l.attributes.position.values,m=p.length,y=r.wall,d=r.top||y,h=r.bottom||y;if(n.st||n.normal||n.tangent||n.bitangent||u){var f=r.boundingRectangle,b=r.tangentPlane,_=r.ellipsoid,v=r.stRotation,P=r.perPositionHeight,C=k;C.x=f.x,C.y=f.y;var x,w=n.st?new Float32Array(m/3*2):void 0;n.normal&&(x=P&&d&&!y?l.attributes.normal.values:new Float32Array(m));var T,I=n.tangent?new Float32Array(m):void 0,A=n.bitangent?new Float32Array(m):void 0,E=u?new Float32Array(m):void 0,V=0,Q=0,q=D,K=L,Z=N,J=!0,X=U,$=j;$=0!==v?(T=i.Quaternion.fromAxisAngle(b._plane.normal,v,Y),X=i.Matrix3.fromQuaternion(T,X),T=i.Quaternion.fromAxisAngle(b._plane.normal,-v,Y),i.Matrix3.fromQuaternion(T,$)):(X=i.Matrix3.clone(i.Matrix3.IDENTITY,X),i.Matrix3.clone(i.Matrix3.IDENTITY,$));var ee=0,te=0;d&&h&&(ee=m/2,te=m/3,m/=2);for(var re=0;re<m;re+=3){var oe,ae,ie,ne,se,le,ue,ce,pe=t.Cartesian3.fromArray(p,re,W);n.st&&(oe=i.Matrix3.multiplyByVector(X,pe,F),oe=_.scaleToGeodeticSurface(oe,oe),ae=b.projectPointOntoPlane(oe,z),t.Cartesian2.subtract(ae,C,ae),ie=g.CesiumMath.clamp(ae.x/f.width,0,1),ne=g.CesiumMath.clamp(ae.y/f.height,0,1),h&&(w[V+te]=ie,w[V+1+te]=ne),d&&(w[V]=ie,w[V+1]=ne),V+=2),(n.normal||n.tangent||n.bitangent||u)&&(se=Q+1,le=Q+2,y?(re+3<m&&(ue=t.Cartesian3.fromArray(p,re+3,H),J&&(ce=t.Cartesian3.fromArray(p,re+m,R),P&&(a=pe,oe=ue,ae=ce,ie=void 0,ie=(ne=_).cartesianToCartographic(a,G).height,(a=ne.cartesianToCartographic(oe,O)).height=ie,ne.cartographicToCartesian(a,oe),(oe=ne.cartesianToCartographic(ae,O)).height=ie-100,ne.cartographicToCartesian(oe,ae)),t.Cartesian3.subtract(ue,pe,ue),t.Cartesian3.subtract(ce,pe,ce),q=t.Cartesian3.normalize(t.Cartesian3.cross(ce,ue,q),q),J=!1),t.Cartesian3.equalsEpsilon(ue,pe,g.CesiumMath.EPSILON10)&&(J=!0)),(n.tangent||n.bitangent)&&(Z=_.geodeticSurfaceNormal(pe,Z),n.tangent&&(K=t.Cartesian3.normalize(t.Cartesian3.cross(Z,q,K),K)))):(q=_.geodeticSurfaceNormal(pe,q),(n.tangent||n.bitangent)&&(P&&(M=t.Cartesian3.fromArray(x,Q,M),S=t.Cartesian3.cross(t.Cartesian3.UNIT_Z,M,S),S=t.Cartesian3.normalize(i.Matrix3.multiplyByVector($,S,S),S),n.bitangent&&(B=t.Cartesian3.normalize(t.Cartesian3.cross(M,S,B),B))),K=t.Cartesian3.cross(t.Cartesian3.UNIT_Z,q,K),K=t.Cartesian3.normalize(i.Matrix3.multiplyByVector($,K,K),K),n.bitangent&&(Z=t.Cartesian3.normalize(t.Cartesian3.cross(q,K,Z),Z)))),n.normal&&(r.wall?(x[Q+ee]=q.x,x[se+ee]=q.y,x[le+ee]=q.z):h&&(x[Q+ee]=-q.x,x[se+ee]=-q.y,x[le+ee]=-q.z),(d&&!P||y)&&(x[Q]=q.x,x[se]=q.y,x[le]=q.z)),u&&(y&&(q=_.geodeticSurfaceNormal(pe,q)),E[Q+ee]=-q.x,E[se+ee]=-q.y,E[le+ee]=-q.z),n.tangent&&(r.wall?(I[Q+ee]=K.x,I[se+ee]=K.y,I[le+ee]=K.z):h&&(I[Q+ee]=-K.x,I[se+ee]=-K.y,I[le+ee]=-K.z),d&&(P?(I[Q]=S.x,I[se]=S.y,I[le]=S.z):(I[Q]=K.x,I[se]=K.y,I[le]=K.z))),n.bitangent&&(h&&(A[Q+ee]=Z.x,A[se+ee]=Z.y,A[le+ee]=Z.z),d&&(P?(A[Q]=B.x,A[se]=B.y,A[le]=B.z):(A[Q]=Z.x,A[se]=Z.y,A[le]=Z.z))),Q+=3)}n.st&&(l.attributes.st=new c.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:w})),n.normal&&(l.attributes.normal=new c.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x})),n.tangent&&(l.attributes.tangent=new c.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:I})),n.bitangent&&(l.attributes.bitangent=new c.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),u&&(l.attributes.extrudeDirection=new c.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E}))}return r.extrude&&e.defined(r.offsetAttribute)&&(v=p.length/3,T=new Uint8Array(v),r.offsetAttribute===o.GeometryOffsetAttribute.TOP?d&&h||y?T=o.arrayFill(T,1,0,v/2):d&&(T=o.arrayFill(T,1)):(v=r.offsetAttribute===o.GeometryOffsetAttribute.NONE?0:1,T=o.arrayFill(T,v)),l.attributes.applyOffset=new c.GeometryAttribute({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:T})),l}var q=new t.Cartographic,K=new t.Cartographic,Z={westOverIDL:0,eastOverIDL:0},J=new l.EllipsoidGeodesic;function X(o,a,i,n,s){if(s=e.defaultValue(s,new t.Rectangle),!e.defined(o)||o.length<3)return s.west=0,s.north=0,s.south=0,s.east=0,s;if(i===r.ArcType.RHUMB)return t.Rectangle.fromCartesianArray(o,a,s);J.ellipsoid.equals(a)||(J=new l.EllipsoidGeodesic(void 0,void 0,a)),s.west=Number.POSITIVE_INFINITY,s.east=Number.NEGATIVE_INFINITY,s.south=Number.POSITIVE_INFINITY,s.north=Number.NEGATIVE_INFINITY,Z.westOverIDL=Number.POSITIVE_INFINITY,Z.eastOverIDL=Number.NEGATIVE_INFINITY;for(var u,c=1/g.CesiumMath.chordLength(n,a.maximumRadius),p=o.length,m=a.cartesianToCartographic(o[0],K),y=q,d=1;d<p;d++)u=y,y=m,m=a.cartesianToCartographic(o[d],u),J.setEndPoints(y,m),ee(J,c,s,Z);return u=y,y=m,m=a.cartesianToCartographic(o[0],u),J.setEndPoints(y,m),ee(J,c,s,Z),s.east-s.west>Z.eastOverIDL-Z.westOverIDL&&(s.west=Z.westOverIDL,s.east=Z.eastOverIDL,s.east>g.CesiumMath.PI&&(s.east=s.east-g.CesiumMath.TWO_PI),s.west>g.CesiumMath.PI&&(s.west=s.west-g.CesiumMath.TWO_PI)),s}var $=new t.Cartographic;function ee(e,t,r,o){for(var a=e.surfaceDistance,i=Math.ceil(a*t),n=0<i?a/(i-1):Number.POSITIVE_INFINITY,s=0,l=0;l<i;l++){var u=e.interpolateUsingSurfaceDistance(s,$);s+=n;var c=u.longitude;u=u.latitude,r.west=Math.min(r.west,c),r.east=Math.max(r.east,c),r.south=Math.min(r.south,u),r.north=Math.max(r.north,u),c=0<=c?c:c+g.CesiumMath.TWO_PI,o.westOverIDL=Math.min(o.westOverIDL,c),o.eastOverIDL=Math.max(o.eastOverIDL,c)}}var te=[];function re(o){var a,i=o.polygonHierarchy,n=e.defaultValue(o.vertexFormat,f.VertexFormat.DEFAULT),s=e.defaultValue(o.ellipsoid,t.Ellipsoid.WGS84),l=e.defaultValue(o.granularity,g.CesiumMath.RADIANS_PER_DEGREE),u=e.defaultValue(o.stRotation,0),c=e.defaultValue(o.perPositionHeight,!1),p=c&&e.defined(o.extrudedHeight),m=e.defaultValue(o.height,0),y=e.defaultValue(o.extrudedHeight,m);p||(a=Math.max(m,y),y=Math.min(m,y),m=a),this._vertexFormat=f.VertexFormat.clone(n),this._ellipsoid=t.Ellipsoid.clone(s),this._granularity=l,this._stRotation=u,this._height=m,this._extrudedHeight=y,this._closeTop=e.defaultValue(o.closeTop,!0),this._closeBottom=e.defaultValue(o.closeBottom,!0),this._polygonHierarchy=i,this._perPositionHeight=c,this._perPositionHeightExtrude=p,this._shadowVolume=e.defaultValue(o.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=o.offsetAttribute,this._arcType=e.defaultValue(o.arcType,r.ArcType.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=d.PolygonGeometryLibrary.computeHierarchyPackedLength(i)+t.Ellipsoid.packedLength+f.VertexFormat.packedLength+12}re.fromPositions=function(t){return new re({polygonHierarchy:{positions:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions},height:t.height,extrudedHeight:t.extrudedHeight,vertexFormat:t.vertexFormat,stRotation:t.stRotation,ellipsoid:t.ellipsoid,granularity:t.granularity,perPositionHeight:t.perPositionHeight,closeTop:t.closeTop,closeBottom:t.closeBottom,offsetAttribute:t.offsetAttribute,arcType:t.arcType})},re.pack=function(r,o,a){return a=e.defaultValue(a,0),a=d.PolygonGeometryLibrary.packPolygonHierarchy(r._polygonHierarchy,o,a),t.Ellipsoid.pack(r._ellipsoid,o,a),a+=t.Ellipsoid.packedLength,f.VertexFormat.pack(r._vertexFormat,o,a),a+=f.VertexFormat.packedLength,o[a++]=r._height,o[a++]=r._extrudedHeight,o[a++]=r._granularity,o[a++]=r._stRotation,o[a++]=r._perPositionHeightExtrude?1:0,o[a++]=r._perPositionHeight?1:0,o[a++]=r._closeTop?1:0,o[a++]=r._closeBottom?1:0,o[a++]=r._shadowVolume?1:0,o[a++]=e.defaultValue(r._offsetAttribute,-1),o[a++]=r._arcType,o[a]=r.packedLength,o};var oe=t.Ellipsoid.clone(t.Ellipsoid.UNIT_SPHERE),ae=new f.VertexFormat,ie={polygonHierarchy:{}};return re.unpack=function(r,o,a){o=e.defaultValue(o,0);var i=d.PolygonGeometryLibrary.unpackPolygonHierarchy(r,o);o=i.startingIndex,delete i.startingIndex;var n=t.Ellipsoid.unpack(r,o,oe);o+=t.Ellipsoid.packedLength;var s=f.VertexFormat.unpack(r,o,ae);o+=f.VertexFormat.packedLength;var l=r[o++],u=r[o++],c=r[o++],p=r[o++],m=1===r[o++],y=1===r[o++],g=1===r[o++],h=1===r[o++],b=1===r[o++],_=r[o++],v=r[o++];return o=r[o],(a=e.defined(a)?a:new re(ie))._polygonHierarchy=i,a._ellipsoid=t.Ellipsoid.clone(n,a._ellipsoid),a._vertexFormat=f.VertexFormat.clone(s,a._vertexFormat),a._height=l,a._extrudedHeight=u,a._granularity=c,a._stRotation=p,a._perPositionHeightExtrude=m,a._perPositionHeight=y,a._closeTop=g,a._closeBottom=h,a._shadowVolume=b,a._offsetAttribute=-1===_?void 0:_,a._arcType=v,a.packedLength=o,a},re.computeRectangle=function(o,a){var i=e.defaultValue(o.granularity,g.CesiumMath.RADIANS_PER_DEGREE),n=e.defaultValue(o.arcType,r.ArcType.GEODESIC),s=o.polygonHierarchy;return o=e.defaultValue(o.ellipsoid,t.Ellipsoid.WGS84),X(s.positions,o,n,i,a)},re.createGeometry=function(t){var r=t._vertexFormat,a=t._ellipsoid,n=t._granularity,l=t._stRotation,f=t._polygonHierarchy,b=t._perPositionHeight,_=t._closeTop,v=t._closeBottom,P=t._arcType;if(!((I=f.positions).length<3)){var C=u.EllipsoidTangentPlane.fromPoints(I,a),x=(f=d.PolygonGeometryLibrary.polygonsFromHierarchy(f,C.projectPointsOntoPlane.bind(C),!b,a)).hierarchy,w=f.polygons;if(0!==x.length){var T,I=x[0].outerRing,A=(I=d.PolygonGeometryLibrary.computeBoundingRectangle(C.plane.normal,C.projectPointOntoPlane.bind(C),I,l,V),[]),E=t._height,G=t._extrudedHeight,O={perPositionHeight:b,vertexFormat:r,geometry:void 0,tangentPlane:C,boundingRectangle:I,ellipsoid:a,stRotation:l,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:P};if(t._perPositionHeightExtrude||!g.CesiumMath.equalsEpsilon(E,G,0,g.CesiumMath.EPSILON2))for(O.extrude=!0,O.top=_,O.bottom=v,O.shadowVolume=t._shadowVolume,O.offsetAttribute=t._offsetAttribute,T=0;T<w.length;T++){var F,D=function(e,t,r,o,a,i,n,s,l){var c={walls:[]};if(i||n){t=(w=d.PolygonGeometryLibrary.createGeometryFromPositions(e,t,r,a,s,l)).attributes.position.values;var m=w.indices;if(i&&n){var g,f=(i=t.concat(t)).length/3;(g=y.IndexDatatype.createTypedArray(f,2*m.length)).set(m);for(var b=m.length,_=f/2,v=0;v<b;v+=3){var P=g[v]+_,C=g[v+1]+_,x=g[v+2]+_;g[v+b]=x,g[v+1+b]=C,g[v+2+b]=P}w.attributes.position.values=i,a&&s.normal&&(s=w.attributes.normal.values,w.attributes.normal.values=new Float32Array(i.length),w.attributes.normal.values.set(s)),w.indices=g}else if(n){for(f=t.length/3,g=y.IndexDatatype.createTypedArray(f,m.length),v=0;v<m.length;v+=3)g[v]=m[v+2],g[v+1]=m[v+1],g[v+2]=m[v];w.indices=g}c.topAndBottom=new p.GeometryInstance({geometry:w})}var w=o.outerRing,T=u.EllipsoidTangentPlane.fromPoints(w,e).projectPointsOntoPlane(w,te);h.PolygonPipeline.computeWindingOrder2D(T)===h.WindingOrder.CLOCKWISE&&(w=w.slice().reverse());var I=d.PolygonGeometryLibrary.computeWallGeometry(w,e,r,a,l);c.walls.push(new p.GeometryInstance({geometry:I}));var A=o.holes;for(v=0;v<A.length;v++){var E=A[v];T=u.EllipsoidTangentPlane.fromPoints(E,e).projectPointsOntoPlane(E,te),h.PolygonPipeline.computeWindingOrder2D(T)===h.WindingOrder.COUNTER_CLOCKWISE&&(E=E.slice().reverse()),I=d.PolygonGeometryLibrary.computeWallGeometry(E,e,r,a,l),c.walls.push(new p.GeometryInstance({geometry:I}))}return c}(a,w[T],n,x[T],b,_,v,r,P);_&&v?(F=D.topAndBottom,O.geometry=d.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(F.geometry,E,G,a,b)):_?((F=D.topAndBottom).geometry.attributes.position.values=h.PolygonPipeline.scaleToGeodeticHeight(F.geometry.attributes.position.values,E,a,!b),O.geometry=F.geometry):v&&((F=D.topAndBottom).geometry.attributes.position.values=h.PolygonPipeline.scaleToGeodeticHeight(F.geometry.attributes.position.values,G,a,!0),O.geometry=F.geometry),(_||v)&&(O.wall=!1,F.geometry=Q(O),A.push(F));var L=D.walls;O.wall=!0;for(var N=0;N<L.length;N++){var H=L[N];O.geometry=d.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(H.geometry,E,G,a,b),H.geometry=Q(O),A.push(H)}}else for(T=0;T<w.length;T++){var R,M,S=new p.GeometryInstance({geometry:d.PolygonGeometryLibrary.createGeometryFromPositions(a,w[T],n,b,r,P)});S.geometry.attributes.position.values=h.PolygonPipeline.scaleToGeodeticHeight(S.geometry.attributes.position.values,E,a,!b),O.geometry=S.geometry,S.geometry=Q(O),e.defined(t._offsetAttribute)&&(M=S.geometry.attributes.position.values.length,R=new Uint8Array(M/3),M=t._offsetAttribute===o.GeometryOffsetAttribute.NONE?0:1,o.arrayFill(R,M),S.geometry.attributes.applyOffset=new c.GeometryAttribute({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:R})),A.push(S)}return(C=m.GeometryPipeline.combineInstances(A)[0]).attributes.position.values=new Float64Array(C.attributes.position.values),C.indices=y.IndexDatatype.createTypedArray(C.attributes.position.values.length/3,C.indices),I=C.attributes,l=i.BoundingSphere.fromVertices(I.position.values),r.position||delete I.position,new c.Geometry({attributes:I,indices:C.indices,primitiveType:C.primitiveType,boundingSphere:l,offsetAttribute:t._offsetAttribute})}}},re.createShadowVolume=function(e,t,r){var o=e._granularity,a=e._ellipsoid;return t=t(o,a),r=r(o,a),new re({polygonHierarchy:e._polygonHierarchy,ellipsoid:a,stRotation:e._stRotation,granularity:o,perPositionHeight:!1,extrudedHeight:t,height:r,vertexFormat:f.VertexFormat.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(re.prototype,{rectangle:{get:function(){var t;return e.defined(this._rectangle)||(t=this._polygonHierarchy.positions,this._rectangle=X(t,this._ellipsoid,this._arcType,this._granularity)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return e.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0==t)return[0,0,0,1,1,0];var r=e._ellipsoid,o=e._polygonHierarchy.positions;return e=e.rectangle,c.Geometry._textureCoordinateRotationPoints(o,t,r,e)}(this)),this._textureCoordinateRotationPoints}}}),function(r,o){return(r=e.defined(o)?re.unpack(r,o):r)._ellipsoid=t.Ellipsoid.clone(r._ellipsoid),re.createGeometry(r)}}));