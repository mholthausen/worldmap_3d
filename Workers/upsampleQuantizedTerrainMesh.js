define(["./AttributeCompression-9fbb8447","./Transforms-1142ce48","./Cartesian2-08065eec","./when-ad3237a0","./TerrainEncoding-cd3482b3","./IndexDatatype-9504f550","./Check-be2d5acb","./Math-5ca9b250","./OrientedBoundingBox-2cc6ca57","./createTaskProcessorWorker","./combine-1510933d","./RuntimeError-767bd866","./ComponentDatatype-a867ddaa","./WebGLConstants-1c8239cc","./EllipsoidTangentPlane-f8b1fc8b","./AxisAlignedBoundingBox-718a9087","./IntersectionTests-75083888","./Plane-bb88dd7e"],(function(e,t,i,n,s,r,h,u,o,a,p,d,f,l,c,g,m,x){"use strict";var w=function(e,t,i,s,r,h){var u,o;n.defined(h)?h.length=0:h=[];var a,p,d,f,l,c,g=t?(u=i<e,o=s<e,r<e):(u=e<i,o=e<s,e<r);return 1===(t=u+o+g)?u?(a=(e-i)/(s-i),p=(e-i)/(r-i),h.push(1),h.push(2),1!==p&&(h.push(-1),h.push(0),h.push(2),h.push(p)),1!==a&&(h.push(-1),h.push(0),h.push(1),h.push(a))):o?(d=(e-s)/(r-s),f=(e-s)/(i-s),h.push(2),h.push(0),1!==f&&(h.push(-1),h.push(1),h.push(0),h.push(f)),1!==d&&(h.push(-1),h.push(1),h.push(2),h.push(d))):g&&(l=(e-r)/(i-r),c=(e-r)/(s-r),h.push(0),h.push(1),1!==c&&(h.push(-1),h.push(2),h.push(1),h.push(c)),1!==l&&(h.push(-1),h.push(2),h.push(0),h.push(l))):2===t?u||i===e?o||s===e?g||r===e||(p=(e-i)/(r-i),d=(e-s)/(r-s),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(p),h.push(-1),h.push(1),h.push(2),h.push(d)):(c=(e-r)/(s-r),a=(e-i)/(s-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(c),h.push(-1),h.push(0),h.push(1),h.push(a)):(f=(e-s)/(i-s),l=(e-r)/(i-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(f),h.push(-1),h.push(2),h.push(0),h.push(l)):3!==t&&(h.push(0),h.push(1),h.push(2)),h},C=32767,v=16383,B=[],y=[],b=[],I=new i.Cartographic,A=new i.Cartesian3,z=[],M=[],N=[],V=[],E=[],R=new i.Cartesian3,H=new t.BoundingSphere,T=new o.OrientedBoundingBox,O=new i.Cartesian2,U=new i.Cartesian3;function F(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}F.prototype.clone=function(e){return(e=n.defined(e)?e:new F).uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},F.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},F.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],this.second=i[e[++n]],this.ratio=e[++n],++n),n},F.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},F.prototype.isIndexed=function(){return n.defined(this.index)},F.prototype.getH=function(){return n.defined(this.index)?this.heightBuffer[this.index]:u.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},F.prototype.getU=function(){return n.defined(this.index)?this.uBuffer[this.index]:u.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},F.prototype.getV=function(){return n.defined(this.index)?this.vBuffer[this.index]:u.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var P=new i.Cartesian2,S=-1,k=[new i.Cartesian3,new i.Cartesian3],D=[new i.Cartesian3,new i.Cartesian3];function W(t,n){var s=k[++S],r=D[S];return s=e.AttributeCompression.octDecode(t.first.getNormalX(),t.first.getNormalY(),s),r=e.AttributeCompression.octDecode(t.second.getNormalX(),t.second.getNormalY(),r),A=i.Cartesian3.lerp(s,r,t.ratio,A),i.Cartesian3.normalize(A,A),e.AttributeCompression.octEncode(A,n),--S,n}F.prototype.getNormalX=function(){return n.defined(this.index)?this.normalBuffer[2*this.index]:(P=W(this,P)).x},F.prototype.getNormalY=function(){return n.defined(this.index)?this.normalBuffer[2*this.index+1]:(P=W(this,P)).y};var X=[];function K(e,t,i,s,r,h,u,o,a){if(0!==u.length){for(var p=0,d=0;d<u.length;)d=X[p++].initializeFromClipResult(u,d,o);for(var f=0;f<p;++f){var l,c,g=X[f];g.isIndexed()?(g.newIndex=h[g.index],g.uBuffer=e,g.vBuffer=t,g.heightBuffer=i,a&&(g.normalBuffer=s)):(l=g.getKey(),n.defined(h[l])?g.newIndex=h[l]:(c=e.length,e.push(g.getU()),t.push(g.getV()),i.push(g.getH()),a&&(s.push(g.getNormalX()),s.push(g.getNormalY())),g.newIndex=c,h[l]=c))}3===p?(r.push(X[0].newIndex),r.push(X[1].newIndex),r.push(X[2].newIndex)):4===p&&(r.push(X[0].newIndex),r.push(X[1].newIndex),r.push(X[2].newIndex),r.push(X[0].newIndex),r.push(X[2].newIndex),r.push(X[3].newIndex))}}return X.push(new F),X.push(new F),X.push(new F),X.push(new F),a((function(e,n){var h=e.isEastChild,a=e.isNorthChild,p=h?v:0,d=h?C:v,f=a?v:0,l=a?C:v,c=z,g=M,m=N,x=E;c.length=0,g.length=0,m.length=0,x.length=0;var P=V;P.length=0;for(var S={},k=e.vertices,D=(D=e.indices).subarray(0,e.indexCountWithoutSkirts),W=s.TerrainEncoding.clone(e.encoding),X=W.hasVertexNormals,Y=0,L=e.vertexCountWithoutSkirts,_=e.minimumHeight,G=e.maximumHeight,J=new Array(L),Z=new Array(L),j=new Array(L),q=X?new Array(2*L):void 0,Q=0,$=0;Q<L;++Q,$+=2){var ee=W.decodeTextureCoordinates(k,Q,O),te=W.decodeHeight(k,Q),ie=u.CesiumMath.clamp(ee.x*C|0,0,C),ne=u.CesiumMath.clamp(ee.y*C|0,0,C);j[Q]=u.CesiumMath.clamp((te-_)/(G-_)*C|0,0,C),C-(ie=ie<20?0:ie)<20&&(ie=C),C-(ne=ne<20?0:ne)<20&&(ne=C),J[Q]=ie,Z[Q]=ne,X&&(ee=W.getOctEncodedNormal(k,Q,U),q[$]=ee.x,q[$+1]=ee.y),(h&&v<=ie||!h&&ie<=v)&&(a&&v<=ne||!a&&ne<=v)&&(S[Q]=Y,c.push(ie),g.push(ne),m.push(j[Q]),X&&(x.push(q[$]),x.push(q[$+1])),++Y)}var se=[];se.push(new F),se.push(new F),se.push(new F);var re=[];for(re.push(new F),re.push(new F),re.push(new F),Q=0;Q<D.length;Q+=3){var he=D[Q],ue=D[Q+1],oe=D[Q+2],ae=J[he],pe=J[ue],de=J[oe];se[0].initializeIndexed(J,Z,j,q,he),se[1].initializeIndexed(J,Z,j,q,ue),se[2].initializeIndexed(J,Z,j,q,oe),(pe=w(v,h,ae,pe,de,B)).length<=0||(de=re[0].initializeFromClipResult(pe,0,se))>=pe.length||(de=re[1].initializeFromClipResult(pe,de,se))>=pe.length||(de=re[2].initializeFromClipResult(pe,de,se),K(c,g,m,x,P,S,w(v,a,re[0].getV(),re[1].getV(),re[2].getV(),y),re,X),de<pe.length&&(re[2].clone(re[1]),re[2].initializeFromClipResult(pe,de,se),K(c,g,m,x,P,S,w(v,a,re[0].getV(),re[1].getV(),re[2].getV(),y),re,X)))}var fe=h?-C:0,le=a?-C:0,ce=[],ge=[],me=[],xe=[],we=Number.MAX_VALUE,Ce=-we,ve=b;ve.length=0;var Be=i.Ellipsoid.clone(e.ellipsoid),ye=(He=i.Rectangle.clone(e.childRectangle)).north,be=He.south,Ie=He.east,Ae=He.west;for(Ie<Ae&&(Ie+=u.CesiumMath.TWO_PI),Q=0;Q<c.length;++Q)ie=(ie=Math.round(c[Q]))<=p?(ce.push(Q),0):d<=ie?(me.push(Q),C):2*ie+fe,c[Q]=ie,ne=(ne=Math.round(g[Q]))<=f?(ge.push(Q),0):l<=ne?(xe.push(Q),C):2*ne+le,g[Q]=ne,(te=u.CesiumMath.lerp(_,G,m[Q]/C))<we&&(we=te),Ce<te&&(Ce=te),m[Q]=te,I.longitude=u.CesiumMath.lerp(Ae,Ie,ie/C),I.latitude=u.CesiumMath.lerp(be,ye,ne/C),I.height=te,Be.cartographicToCartesian(I,A),ve.push(A.x),ve.push(A.y),ve.push(A.z);var ze=t.BoundingSphere.fromVertices(ve,i.Cartesian3.ZERO,3,H),Me=o.OrientedBoundingBox.fromRectangle(He,we,Ce,Be,T),Ne=(e=new s.EllipsoidalOccluder(Be).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ze.center,ve,3,ze.center,we,R),Ce-we),Ve=new Uint16Array(c.length+g.length+m.length);for(Q=0;Q<c.length;++Q)Ve[Q]=c[Q];var Ee=c.length;for(Q=0;Q<g.length;++Q)Ve[Ee+Q]=g[Q];for(Ee+=g.length,Q=0;Q<m.length;++Q)Ve[Ee+Q]=C*(m[Q]-we)/Ne;var Re,He=r.IndexDatatype.createTypedArray(c.length,P);return X?(Re=new Uint8Array(x),n.push(Ve.buffer,He.buffer,Re.buffer),Re=Re.buffer):n.push(Ve.buffer,He.buffer),{vertices:Ve.buffer,encodedNormals:Re,indices:He.buffer,minimumHeight:we,maximumHeight:Ce,westIndices:ce,southIndices:ge,eastIndices:me,northIndices:xe,boundingSphere:ze,orientedBoundingBox:Me,horizonOcclusionPoint:e}}))}));