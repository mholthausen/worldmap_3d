define(["./ComponentDatatype-a867ddaa","./when-ad3237a0","./IndexDatatype-9504f550","./RuntimeError-767bd866","./createTaskProcessorWorker","./Check-be2d5acb","./WebGLConstants-1c8239cc","./Math-5ca9b250"],(function(e,t,r,n,a,o,i,u){"use strict";var s;function d(r,n,a){var o,i=r.num_points(),u=a.num_components(),d=new s.AttributeQuantizationTransform;if(d.InitFromAttribute(a)){for(var c=new Array(u),y=0;y<u;++y)c[y]=d.min_value(y);o={quantizationBits:d.quantization_bits(),minValues:c,range:d.range(),octEncoded:!1}}return s.destroy(d),(d=new s.AttributeOctahedronTransform).InitFromAttribute(a)&&(o={quantizationBits:d.quantization_bits(),octEncoded:!0}),s.destroy(d),i*=u,{array:n=t.defined(o)?function(e,t,r,n,a){var o,i;n.quantizationBits<=8?(i=new s.DracoUInt8Array,o=new Uint8Array(a),t.GetAttributeUInt8ForAllPoints(e,r,i)):(i=new s.DracoUInt16Array,o=new Uint16Array(a),t.GetAttributeUInt16ForAllPoints(e,r,i));for(var u=0;u<a;++u)o[u]=i.GetValue(u);return s.destroy(i),o}(r,n,a,o,i):function(e,t,r,n){var a,o;switch(r.data_type()){case 1:case 11:o=new s.DracoInt8Array,a=new Int8Array(n),t.GetAttributeInt8ForAllPoints(e,r,o);break;case 2:o=new s.DracoUInt8Array,a=new Uint8Array(n),t.GetAttributeUInt8ForAllPoints(e,r,o);break;case 3:o=new s.DracoInt16Array,a=new Int16Array(n),t.GetAttributeInt16ForAllPoints(e,r,o);break;case 4:o=new s.DracoUInt16Array,a=new Uint16Array(n),t.GetAttributeUInt16ForAllPoints(e,r,o);break;case 5:case 7:o=new s.DracoInt32Array,a=new Int32Array(n),t.GetAttributeInt32ForAllPoints(e,r,o);break;case 6:case 8:o=new s.DracoUInt32Array,a=new Uint32Array(n),t.GetAttributeUInt32ForAllPoints(e,r,o);break;case 9:case 10:o=new s.DracoFloat32Array,a=new Float32Array(n),t.GetAttributeFloatForAllPoints(e,r,o)}for(var i=0;i<n;++i)a[i]=o.GetValue(i);return s.destroy(o),a}(r,n,a,i),data:{componentsPerAttribute:u,componentDatatype:i=e.ComponentDatatype.fromTypedArray(n),byteOffset:a.byte_offset(),byteStride:e.ComponentDatatype.getSizeInBytes(i)*u,normalized:a.normalized(),quantization:o}}}function c(e){var t=new s.Decoder,a=["POSITION","NORMAL","COLOR","TEX_COORD"];if(e.dequantizeInShader)for(var o=0;o<a.length;++o)t.SkipAttributeTransform(s[a[o]]);var i=e.bufferView,u=new s.DecoderBuffer;if(u.Init(e.array,i.byteLength),t.GetEncodedGeometryType(u)!==s.TRIANGULAR_MESH)throw new n.RuntimeError("Unsupported draco mesh geometry type.");var c=new s.Mesh;if(!(i=t.DecodeBufferToMesh(u,c)).ok()||0===c.ptr)throw new n.RuntimeError("Error decoding draco mesh geometry: "+i.error_msg());s.destroy(u);var y,f,A={},b=e.compressedAttributes;for(y in b)b.hasOwnProperty(y)&&(f=b[y],f=t.GetAttributeByUniqueId(c,f),A[y]=d(c,t,f));return e={indexArray:function(e,t){for(var n=e.num_points(),a=e.num_faces(),o=new s.DracoInt32Array,i=3*a,u=r.IndexDatatype.createTypedArray(n,i),d=0,c=0;c<a;++c)t.GetFaceFromMesh(e,c,o),u[d+0]=o.GetValue(0),u[d+1]=o.GetValue(1),u[d+2]=o.GetValue(2),d+=3;return s.destroy(o),{typedArray:u,numberOfIndices:i}}(c,t),attributeData:A},s.destroy(c),s.destroy(t),e}function y(e){return(t.defined(e.bufferView)?c:function(e){var t=new s.Decoder;e.dequantizeInShader&&(t.SkipAttributeTransform(s.POSITION),t.SkipAttributeTransform(s.NORMAL));var r=new s.DecoderBuffer;if(r.Init(e.buffer,e.buffer.length),t.GetEncodedGeometryType(r)!==s.POINT_CLOUD)throw new n.RuntimeError("Draco geometry type must be POINT_CLOUD.");var a=new s.PointCloud,o=t.DecodeBufferToPointCloud(r,a);if(!o.ok()||0===a.ptr)throw new n.RuntimeError("Error decoding draco point cloud: "+o.error_msg());s.destroy(r);var i,u,c={},y=e.properties;for(i in y)y.hasOwnProperty(i)&&(u=y[i],u=t.GetAttributeByUniqueId(a,u),c[i]=d(a,t,u));return s.destroy(a),s.destroy(t),c})(e)}function f(e){s=e,self.onmessage=a(y),self.postMessage(!0)}return function(e){var r=e.data.webAssemblyConfig;if(t.defined(r))return require([r.modulePath],(function(e){t.defined(r.wasmBinaryFile)?(e=t.defined(e)?e:self.DracoDecoderModule)(r).then((function(e){f(e)})):f(e())}))}}));